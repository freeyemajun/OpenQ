<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Discuz! X3.4 转换 Discuz! Q | DiscuzQ 安装文档</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script>
      document.addEventListener("DOMContentLoaded", function(){
        console.log("ready");
        var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        if (window.location.hash && isChrome) {
            setTimeout(function () {
                var hash = window.location.hash;
                var element_to_scroll_to = document.getElementById(decodeURI(hash.substr(1)));
                element_to_scroll_to.scrollIntoView();
            }, 300);
        }
      });
</script>
    <meta name="description" content="">
    
    <link rel="preload" href="/docs/assets/css/0.styles.1dac2540.css" as="style"><link rel="preload" href="/docs/assets/js/app.4a94bff3.js" as="script"><link rel="preload" href="/docs/assets/js/2.65b3c0ea.js" as="script"><link rel="preload" href="/docs/assets/js/1.93f47670.js" as="script"><link rel="preload" href="/docs/assets/js/33.80a8af0e.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.e303b1fe.js"><link rel="prefetch" href="/docs/assets/js/11.caa9adf9.js"><link rel="prefetch" href="/docs/assets/js/12.f47f63d5.js"><link rel="prefetch" href="/docs/assets/js/13.93dc81ea.js"><link rel="prefetch" href="/docs/assets/js/14.704d1a26.js"><link rel="prefetch" href="/docs/assets/js/15.2330e6dc.js"><link rel="prefetch" href="/docs/assets/js/16.6aaa40a5.js"><link rel="prefetch" href="/docs/assets/js/17.e32a5229.js"><link rel="prefetch" href="/docs/assets/js/18.1fa05986.js"><link rel="prefetch" href="/docs/assets/js/19.53f57844.js"><link rel="prefetch" href="/docs/assets/js/20.864577f6.js"><link rel="prefetch" href="/docs/assets/js/21.b4e831fa.js"><link rel="prefetch" href="/docs/assets/js/22.243f8c8f.js"><link rel="prefetch" href="/docs/assets/js/23.7addb889.js"><link rel="prefetch" href="/docs/assets/js/24.ef0496a7.js"><link rel="prefetch" href="/docs/assets/js/25.89b549f4.js"><link rel="prefetch" href="/docs/assets/js/26.0a614c82.js"><link rel="prefetch" href="/docs/assets/js/27.c737aa41.js"><link rel="prefetch" href="/docs/assets/js/28.1e6bd7b4.js"><link rel="prefetch" href="/docs/assets/js/29.3f95441b.js"><link rel="prefetch" href="/docs/assets/js/3.640e72c3.js"><link rel="prefetch" href="/docs/assets/js/30.778c4be0.js"><link rel="prefetch" href="/docs/assets/js/31.7bb18d07.js"><link rel="prefetch" href="/docs/assets/js/32.ace851f7.js"><link rel="prefetch" href="/docs/assets/js/34.d85fff39.js"><link rel="prefetch" href="/docs/assets/js/35.3adf9801.js"><link rel="prefetch" href="/docs/assets/js/36.9a107e60.js"><link rel="prefetch" href="/docs/assets/js/37.6d5ed231.js"><link rel="prefetch" href="/docs/assets/js/38.d4773946.js"><link rel="prefetch" href="/docs/assets/js/39.1f25f111.js"><link rel="prefetch" href="/docs/assets/js/4.6fcba847.js"><link rel="prefetch" href="/docs/assets/js/40.a7c7edfd.js"><link rel="prefetch" href="/docs/assets/js/41.6c906a58.js"><link rel="prefetch" href="/docs/assets/js/42.19af8c9b.js"><link rel="prefetch" href="/docs/assets/js/43.c3501ba2.js"><link rel="prefetch" href="/docs/assets/js/44.095b6352.js"><link rel="prefetch" href="/docs/assets/js/45.f712c735.js"><link rel="prefetch" href="/docs/assets/js/46.ea4a5f90.js"><link rel="prefetch" href="/docs/assets/js/47.4c923c28.js"><link rel="prefetch" href="/docs/assets/js/48.a2893909.js"><link rel="prefetch" href="/docs/assets/js/49.4c0fc68d.js"><link rel="prefetch" href="/docs/assets/js/5.5755b19e.js"><link rel="prefetch" href="/docs/assets/js/50.a768c789.js"><link rel="prefetch" href="/docs/assets/js/51.9145a08d.js"><link rel="prefetch" href="/docs/assets/js/52.bea51864.js"><link rel="prefetch" href="/docs/assets/js/53.d24412c9.js"><link rel="prefetch" href="/docs/assets/js/54.cd9f37d4.js"><link rel="prefetch" href="/docs/assets/js/55.a856d50b.js"><link rel="prefetch" href="/docs/assets/js/56.b3072981.js"><link rel="prefetch" href="/docs/assets/js/57.e9c27eb6.js"><link rel="prefetch" href="/docs/assets/js/58.a94f49c6.js"><link rel="prefetch" href="/docs/assets/js/59.76707aea.js"><link rel="prefetch" href="/docs/assets/js/6.c1859e2f.js"><link rel="prefetch" href="/docs/assets/js/60.79251db4.js"><link rel="prefetch" href="/docs/assets/js/61.742230c8.js"><link rel="prefetch" href="/docs/assets/js/62.ca1bb933.js"><link rel="prefetch" href="/docs/assets/js/63.75830b2e.js"><link rel="prefetch" href="/docs/assets/js/64.243cb0d7.js"><link rel="prefetch" href="/docs/assets/js/7.d29ddd45.js"><link rel="prefetch" href="/docs/assets/js/vendors~docsearch.d97d6166.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.1dac2540.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">DiscuzQ 安装文档</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://discuzq.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  返回
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="https://discuzq.icu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  返回
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安装</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>使用</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>配置</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>升级和转换</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/升级/常规部署升级.html" class="sidebar-link">常规部署方式升级</a></li><li><a href="/docs/升级/镜像部署方式升级.html" class="sidebar-link">镜像部署方式升级</a></li><li><a href="/docs/升级/Docker 部署方式升级.html" class="sidebar-link">Docker容器部署方式升级</a></li><li><a href="/docs/升级/小程序的升级.html" class="sidebar-link">微信小程序升级</a></li><li><a href="/docs/升级/Discuzto.html" class="active sidebar-link">Discuz! X3.4 转换 Discuz! Q</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/升级/本地数据迁移.html" class="sidebar-link">本地数据迁移 COS</a></li><li><a href="/docs/升级/站点接入 CDN.html" class="sidebar-link">站点接入 CDN</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="discuz-x3-4-转换-discuz-q"><a href="#discuz-x3-4-转换-discuz-q" class="header-anchor">#</a> Discuz! X3.4 转换 Discuz! Q</h1> <h2>操作场景</h2> <p>本文档将指导您如何将 Discuz! X3.4 应用程序数据迁移至Discuz! Q 应用程序，通过该操作可以将 Discuz! X3.4 中的用户、版块、普通主题、回复、附件图片等数据转换至 Discuz! Q。</p> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <ul><li>在转换程序开始前，为确保因操作失误，导致数据丢失等问题，请提前做好数据备份。</li> <li>在转换程序开始前，请保证 Discuz! Q 数据库为全新安装，或者只通过本操作提供的转换程序转换过数据。否则将可能会导致数据丢失，或转换错误。</li> <li>转换程序工具需要在 PHP 7.2.5 及以上环境运行，请确保已配置该环境。建议在部署的 Discuz! Q 站点运行。本文档以在部署的 Discuz! Q 的服务器上进行转化为例。</li> <li>Discuz! Q 转换工具仅支持 Discuz! X3.4 转 Discuz! Q 2.0 版本，不支持 Discuz! Q 3.0。若您需使用 Discuz! Q 3.0 以上版本，建议您安装部署 Discuz! Q 2.0 版本转换后在<a href="https://discuz.com/docs/%E5%B8%B8%E8%A7%84%E9%83%A8%E7%BD%B2%E5%8D%87%E7%BA%A7.html" target="_blank" rel="noopener noreferrer">升级为 Discuz! Q 3.0 以上版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。Discuz! Q 2.0 版本建议使用 v0.3.200315 进行转换，兼容性更高。</li> <li>安装指定 Discuz! Q 版本详情参见：<a href="https://discuz.chat/thread/48991" target="_blank" rel="noopener noreferrer">Discuz! Q | 常见问题 QA 及其他<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul></div> <h2>前提条件</h2> <ul><li>已部署 Discuz! Q。</li> <li>具备 PHP 7.2.5 及以上环境的主机。</li></ul> <h2>操作步骤</h2> <h3 id="步骤一-下载并解压转化工具"><a href="#步骤一-下载并解压转化工具" class="header-anchor">#</a> 步骤一：下载并解压转化工具</h3> <ol><li>您可以 <a href="https://discuzq-docs-1258344699.cos.ap-guangzhou.myqcloud.com/convert/xconvertq.zip" target="_blank" rel="noopener noreferrer">单击此处<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载转化工具至 已部署的 Discuz! Q 的服务器上。</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您是 Linux 服务器，您可以在服务器的终端中，通过该命令进行下载 <code>wget -c https://discuzq-docs-1258344699.cos.ap-guangzhou.myqcloud.com/convert/xconvertq.zip</code>。</p></div> <ol start="2"><li>使用解压工具解压压缩包。</li></ol> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>如果您是 Linux 服务器，您可以在服务器的终端中，通过该命令进行解压 <code>unzip xconvertq.zip</code>。</p></div> <h3 id="步骤二-配置转化工具"><a href="#步骤二-配置转化工具" class="header-anchor">#</a> 步骤二：配置转化工具</h3> <h4 id="配置转化工具数据库信息"><a href="#配置转化工具数据库信息" class="header-anchor">#</a> 配置转化工具数据库信息</h4> <ol><li><p>在解压出的 <code>xconvertq</code> 文件夹中，找到 <code>config</code> 目录下的<code>database.php</code>文件，并使用文本编辑器或使用 WinSCP 等工具打开该文件。</p></li> <li><p>在 <code>database.php</code> 文件中配置数据库信息。信息内容可根据文件中注释进行填写。如下所示：</p></li></ol> <div class="language-mysql extra-class"><pre class="language-text"><code>&lt;?php

return [
    'discuzq' =&gt; [
        'driver'    =&gt; 'mysql',
        'host'      =&gt; 'localhost', //Q数据库地址
        'port' =&gt; '3306', //Q数据库端口
        'prefix'    =&gt; 'pre_', //Q表前缀，没有则留空
        'database'  =&gt; '', //Q数据库名
        'username'  =&gt; '', //Q数据库用户
        'password'  =&gt; '', //Q数据库密码
        'charset'   =&gt; 'utf8', //Q数据编码
        'collation' =&gt; 'utf8mb4_unicode_ci', //Q数据库字符集
    ],
    'discuzx' =&gt; [
        'driver'    =&gt; 'mysql',
        'host'      =&gt; 'localhost', //X数据库地址
        'port' =&gt; '3306', //X数据库端口
        'prefix'    =&gt; 'pre_', //X表前缀，没有则留空
        'database'  =&gt; '', //X数据库名
        'username'  =&gt; '', //X数据库用户
        'password'  =&gt; '', //X数据库密码
        'charset'   =&gt; 'utf8', //X数据编码
        'collation' =&gt; 'utf8_unicode_ci', //X数据库字符集
    ]
];
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>其中 <code>discuzq</code> 为 <code>Discuz! Q</code> 数据库连接信息， <code>discuzx</code> 为 <code>Discuz! X3.4</code> 数据库连接信息。</li> <li>若 <code>Discuz! X3.4</code> 为 <code>gbk</code> 编码，数据库连接信息中的<code>X数据编码</code> 和<code>X数据库字符集</code>保持现有默认配置即可。</li></ul></div> <ol start="3"><li>在终端中，在该程序的根目录下输入命令 <code>php discoa app:test</code> 测试数据库是否正常连接。提示 <code>success</code> 即代表连接正常，若提示其他信息，请检查数据库配置信息是否填写正确。</li></ol> <h4 id="配置转化工具转换模式"><a href="#配置转化工具转换模式" class="header-anchor">#</a> 配置转化工具转换模式</h4> <ol><li>在解压出的 <code>xconvertq</code> 文件夹中，找到<code>config</code>目录下的<code>config.php</code>文件，并使用文本编辑器或使用 WinSCP 等工具打开该文件。</li> <li>配置 <code>breakpoint_continuation</code>字段，可选值为 true 与 false。说明如下：</li></ol> <ul><li>当 <code>breakpoint_continuation</code> 字段的值为 <code>true</code>时，表示开启断点续转模式，在此模式下执⾏转换命令，程序会忽略之前转换过的数据。</li> <li>当 <code>breakpoint_continuation</code> 的值为 false 时，程序会先检查Q⽬标表是否有多余数据，如果有则停
⽌执⾏对应的转换任务</li></ul> <h3 id="步骤三-配置-discuz-q-数据库"><a href="#步骤三-配置-discuz-q-数据库" class="header-anchor">#</a> 步骤三：配置 Discuz! Q 数据库</h3> <ol><li>在 Discuz! Q 使用的数据库中运⾏以下 sql 命令：</li></ol> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>请您注意修改以下 sql 命令中 <code>pre_users</code> 的表格前缀，如果没有前缀，去掉 pre_ 即可。</p></div> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>pre_users<span class="token punctuation">`</span></span> <span class="token keyword">ADD</span> <span class="token identifier"><span class="token punctuation">`</span>salt<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">AFTER</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>pre_posts<span class="token punctuation">`</span></span> CHANGE <span class="token identifier"><span class="token punctuation">`</span>content<span class="token punctuation">`</span></span> <span class="token identifier"><span class="token punctuation">`</span>content<span class="token punctuation">`</span></span> <span class="token keyword">MEDIUMTEXT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span>
utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'内容'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="步骤四-修改-discuz-q-文件"><a href="#步骤四-修改-discuz-q-文件" class="header-anchor">#</a> 步骤四：修改 Discuz! Q 文件</h3> <h4 id="更新-discuz-q-登陆验证文件"><a href="#更新-discuz-q-登陆验证文件" class="header-anchor">#</a> 更新 Discuz! Q 登陆验证⽂件</h4> <ol><li>在 Discuz! Q  文件目录中，找到 <code>app/Listeners/User/CheckLogin.php</code> 文件，并使用文本编辑器或使用 WinSCP 等工具打开该文件。</li> <li>编辑 <code>CheckLogin.php</code> 文件，查找以下代码（72⾏附近）。</li></ol> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">''</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token function">checkPassword</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><ol start="3"><li>在以上代码前添加如下代码：</li></ol> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">checkSaltPassword</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>在 <code>CheckLogin.php</code>程序⽂件最后⼀个⼤括号<code>}</code>前，给本⽂件添加如下代码（**注意：**复制粘贴后，换行处会多出空格，例如<code>-&gt;</code>会变成<code>- &gt;</code>，请注意去除）：</li></ol> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
     * @param $event
     * Discuz! X3.4 密码转换
     */</span>
<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">checkSaltPassword</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token property">salt</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$passwordmd5</span> <span class="token operator">=</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\w{32}$/'</span><span class="token punctuation">,</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token punctuation">:</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$passwordmd5</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$passwordmd5</span> <span class="token operator">.</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token property">salt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token operator">==</span> <span class="token variable">$passwordmd5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">password</span><span class="token punctuation">;</span>
      <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token property">salt</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
      <span class="token variable">$event</span><span class="token operator">-&gt;</span><span class="token property">user</span><span class="token operator">-&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>将转换程序⾥的⽂件 <code>app/Formatter/CustomerConfigurator.php</code> 复制到 Discuz! Q 程序
<code>app/Formatter</code>⽬录下，并在 Discuz! Q 程序⽂件 <code>app/Formatter/Formatter.php</code> 中<strong>38⾏</strong>左右找到如下代码：</li></ol> <div class="language-php extra-class"><pre class="language-php"><code><span class="token keyword static-context">parent</span><span class="token operator">::</span><span class="token function">confTopic</span><span class="token punctuation">(</span><span class="token variable">$configurator</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在其后添加如下代码：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token class-name static-context">CustomerConfigurator</span><span class="token operator">::</span><span class="token function">Customer</span><span class="token punctuation">(</span><span class="token variable">$configurator</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>删除 Discuz! Q 程序<code>storage/Formatter</code> ⽬录下的所有缓存⽂件。</li></ol> <h3 id="步骤五-上传附件文件"><a href="#步骤五-上传附件文件" class="header-anchor">#</a> 步骤五：上传附件文件</h3> <ul><li>将 Discuz! X3.4 ⽬录 <code>uc_server/data/avatar</code> 中的所有⽂件上传⾄ Discuz! Q ⽬录<code>storage/app/public/avatars</code>文件夹下，如果 avatars 不存在，请⾃⾏创建该⽬录。</li> <li>将 Discuz! X3.4 ⽬录 <code>data/attachment/forum</code> 中的所有⽂件上传⾄ Discuz! Q ⽬录<code>storage/app/public/attachments</code>，如果 <code>attachments</code> 不存在，请⾃⾏创建该⽬录。</li> <li>将 Discuz! X3.4 ⽬录 <code>data/attachment/commom</code> ⽂件夹上传⾄ Discuz! Q ⽬录 <code>storage/app/public/attachments</code>。</li> <li>将 Discuz! X3.4 ⽬录 <code>static/image/smiley</code> ⽂件夹中的⽂件夹上传⾄ Discuz! Q ⽬录 <code>public/emoji</code>⽬录。</li></ul> <h3 id="步骤六-转换"><a href="#步骤六-转换" class="header-anchor">#</a> 步骤六：转换</h3> <ol><li>转换工具支持以下两种方式进行转化，您可以根据自己的实际需求进选择：</li></ol> <h4 id="一键转换"><a href="#一键转换" class="header-anchor">#</a> ⼀键转换</h4> <p>在命令⾏模式下，在转换程序根⽬录运⾏ <code>php discoa app:xtq</code> 命令，将完成所有本程序定义过的数据的转
换，包含：⽤户数据、版块数据、主题数据、回复数据、附件数据、表情数据。</p> <h4 id="选择转换"><a href="#选择转换" class="header-anchor">#</a> 选择转换</h4> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p>若采⽤选择转换，⽤户数据和版块信息⼀定要在主题、回复信息之前进⾏操作。</p></div> <p>您可以⾃由选择要转换的数据。您可以使⽤ <code>php discoa app:xtq --option</code> 命令，⾃由选择您需要转换的
数据，<code>--option</code> 有以下可使⽤参数：</p> <ul><li>user : ⽤户信息转换。</li> <li>category : 版块信息转换。</li> <li>thread ： 主题信息转换。</li> <li>post ： 回复信息转换。</li> <li>attachment ： 附件信息转换。</li> <li>emoji ： 表情转换。</li> <li>count ：主题、帖⼦、⽤户信息统计更新。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><code>php discoa app:xtq user</code> 表示只转换⽤户信息。</li> <li><code>php discoa app:xtq thread</code> 表示只转换主题信息。</li></ul></div> <ol start="2"><li>转换工具命令运行完毕后即可转换成功。转化工具还支持以下功能。您可以根据您得具体需求进行使用。</li></ol> <h4 id="转化工具辅助功能"><a href="#转化工具辅助功能" class="header-anchor">#</a> 转化工具辅助功能</h4> <p>您可以使⽤ <code>php discoa app:clean cleanDatabase --option</code> 命令清理 Discuz! Q 中数据表数据。您可以
选择以下 <code>--option</code> 参数：</p> <ul><li>user : 清理⽤户数据。</li> <li>userWallet : 清理⽤户钱包数据。</li> <li>category : 清理板块。</li> <li>thread ： 清理主题。</li> <li>post ： 清理回帖。</li> <li>emoji: 清理转换来的表情。</li> <li>attachment ： 清理附件数据。</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>不填写 <code>option</code> 参数时，程序将清理以上所有数据。</p></div> <p>例如：</p> <ul><li><code>php discoa app:clean cleanDatabase</code> 表示清理所有数据。</li> <li><code>php discoa app:clean cleanDatabase user</code> 表示清理⽤户数据。</li></ul> <h3 id="步骤七-discuz-x3-4-网址跳转-discuz-q"><a href="#步骤七-discuz-x3-4-网址跳转-discuz-q" class="header-anchor">#</a> 步骤七：Discuz! X3.4 网址跳转 Discuz! Q</h3> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <ul><li>转换成功后，将导致原 Discuz! X3.4 的网址失效。您可通过以下步骤与配置，让原 Discuz! X3.4 的网址被访问时，可顺利的利用 301 跳转至对应的 Discuz! Q 网址。</li> <li>此步骤非必须，您可根据您的具体需求判断是否配置。</li></ul></div> <p>目前提供以下三种 Web 服务的配置方式，您可根据您的具体情况进行选择配置：</p> <h4 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h4> <ol><li>使用文本编辑器打开您的 Nginx 配置文件，通常为 <code>nginx.conf</code>文件。</li> <li>在配置文件中查找到 <code>server</code> 块并增加如下配置：</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token comment"># 帖子列表</span>
<span class="token directive"><span class="token keyword">rewrite</span> ^/forum-(\d+)-\d+\.html /category/<span class="token variable">$1</span>? redirect</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* ^/forum\.php\?mod=forumdisplay&amp;fid=(\d+))</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$fid</span> <span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/ /category/<span class="token variable">$fid</span>? redirect</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 帖子详情</span>
<span class="token directive"><span class="token keyword">rewrite</span> ^/thread-(\d+)-\d+-\d+\.html /thread/<span class="token variable">$1</span>? redirect</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* ^/forum\.php\?mod=viewthread&amp;tid=(\d+))</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$tid</span> <span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/ /thread/<span class="token variable">$tid</span>? redirect</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 个人主页</span>
<span class="token directive"><span class="token keyword">rewrite</span> ^/space-uid-(\d+)\.html /user/<span class="token variable">$1</span>? redirect</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_uri</span> ~* ^/home\.php\?mod=space&amp;uid=(\d+))</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$uid</span> <span class="token variable">$1</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/ /user/<span class="token variable">$uid</span>? redirect</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>您可以使用以下 <code>nginx</code> 命令检查配置是否正确：</li></ol> <div class="language-nginx extra-class"><pre class="language-nginx"><code>nginx -t
</code></pre></div><ol start="4"><li>重启 Nginx 服务。您可以参考命令：<code>nginx -s reload</code> 进行重启。</li></ol> <h4 id="apache"><a href="#apache" class="header-anchor">#</a> Apache</h4> <ol><li>使用文本编辑器打开您的  <code>.htaccess</code>  配置文件并增加如下配置：</li></ol> <div class="language- extra-class"><pre class="language-text"><code>RewriteEngine On
# 帖子列表
RewriteRule ^/?forum-(\d+)-\d+\.html /category/$1? [R,L]
RewriteCond %{QUERY_STRING} mod=forumdisplay&amp;fid=(\d+)
RewriteRule ^/?forum\.php /category/%1? [R,L]

# 帖子详情
RewriteRule ^/?thread-(\d+)-\d+-\d+\.html /thread/$1? [R,L]
RewriteCond %{QUERY_STRING} mod=viewthread&amp;tid=(\d+)
RewriteRule ^/?forum\.php /thread/%1? [R,L]

# 个人主页
RewriteRule ^/?space-uid-(\d+)\.html /user/$1? [R,L]
RewriteCond %{QUERY_STRING} mod=space&amp;uid=(\d+)
RewriteRule ^/?home\.php /user/%1? [R,L]
</code></pre></div><ol start="2"><li>重启 Apache 服务。您可以参考命令：<code>service httpd restart</code> 进行重启。</li></ol> <h4 id="iis"><a href="#iis" class="header-anchor">#</a> IIS</h4> <ol><li>使用文本编辑器打开您的  <code>web.config</code>  配置文件。</li> <li>在配置文件中的 <code>rules</code> 中增加如下配置：</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>帖子列表伪静态<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stopProcessing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>^forum-(\d+)-\d+\.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Redirect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/category/{R:1}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appendQueryString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Found<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>帖子列表<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stopProcessing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>^forum\.php<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conditions</span> <span class="token attr-name">logicalGrouping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MatchAll<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{QUERY_STRING}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod=forumdisplay<span class="token entity named-entity" title="&amp;">&amp;amp;</span>fid=(\d+)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>conditions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Redirect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/category/{C:1}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appendQueryString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Found<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>帖子详情伪静态<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stopProcessing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>^thread-(\d+)-\d+-\d+\.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Redirect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/thread/{R:1}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appendQueryString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Found<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>帖子详情<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stopProcessing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>^forum\.php<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conditions</span> <span class="token attr-name">logicalGrouping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MatchAll<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{QUERY_STRING}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod=viewthread<span class="token entity named-entity" title="&amp;">&amp;amp;</span>tid=(\d+)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>conditions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Redirect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/thread/{C:1}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appendQueryString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Found<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>个人主页伪静态<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stopProcessing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>^space-uid-(\d+)\.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Redirect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/{R:1}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appendQueryString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Found<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>个人主页<span class="token punctuation">&quot;</span></span> <span class="token attr-name">stopProcessing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>match</span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>^home\.php<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>conditions</span> <span class="token attr-name">logicalGrouping</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>MatchAll<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{QUERY_STRING}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod=space<span class="token entity named-entity" title="&amp;">&amp;amp;</span>uid=(\d+)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ignoreCase</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>conditions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Redirect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/user/{C:1}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">appendQueryString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">redirectType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Found<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="3"><li>重启 IIS 服务。</li></ol> <h3 id="其他注意事项"><a href="#其他注意事项" class="header-anchor">#</a> 其他注意事项</h3> <ol><li><p>目前附件图片不支持七牛云等第三方存储。</p></li> <li><p>若转换过程出现内存溢出报错<code>Fatal error: Allowed memory size of ...</code>时，可尝试修改<code>php.ini</code>配置，将<code>memory_limit</code>适当调大并重启 PHP 服务。</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/升级/小程序的升级.html" class="prev">
        微信小程序升级
      </a></span> <span class="next"><a href="/docs/升级/本地数据迁移.html">
        本地数据迁移 COS
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.4a94bff3.js" defer></script><script src="/docs/assets/js/2.65b3c0ea.js" defer></script><script src="/docs/assets/js/1.93f47670.js" defer></script><script src="/docs/assets/js/33.80a8af0e.js" defer></script>
  </body>
</html>
