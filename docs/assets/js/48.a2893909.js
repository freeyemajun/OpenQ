(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{236:function(i,e,c){"use strict";c.r(e);var t=c(6),d=Object(t.a)({},(function(){var i=this,e=i._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":i.$parent.slotKey}},[e("h1",{attrs:{id:"二次开发部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二次开发部署"}},[i._v("#")]),i._v(" 二次开发部署")]),i._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[i._v("#")]),i._v(" 概述")]),i._v(" "),e("p",[i._v("本文将针对 Discuz! Q 二次开发的开发环境及代码部署进行说明。")]),i._v(" "),e("h2",{attrs:{id:"环境配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境配置"}},[i._v("#")]),i._v(" 环境配置")]),i._v(" "),e("p",[i._v("开发环境使用 Nginx 1.18.0 、PHP 7.3.23 、CentOS 7.6 版本为例。详情参见："),e("a",{attrs:{href:"https://discuz.com/docs/Linux%20%E4%B8%BB%E6%9C%BA.html#nginx",target:"_blank",rel:"noopener noreferrer"}},[i._v("基于手动配置的 Nginx 环境"),e("OutboundLink")],1),i._v("。")]),i._v(" "),e("h2",{attrs:{id:"代码部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码部署"}},[i._v("#")]),i._v(" 代码部署")]),i._v(" "),e("p",[i._v("Discuz! Q 开源主仓库共有4个，若要 fork 仓库进行手动部署，则需要组合四个仓库的代码。详情如下：")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v("Discuz-Q: git@gitee.com:Discuz/Discuz-Q.git  #Discuz! Q 后端主程序\nDiscuz-Q-Framework:  git@gitee.com:Discuz/Discuz-Q-Framework.git #Discuz! Q后端抽象类程序\nDiscuz-Q-uniapp: git@gitee.com:Discuz/Discuz-Q-uniapp.git  #Discuz! Q H5及小程序代码\nDiscuz-Q-Web: git@gitee.com:Discuz/Discuz-Q-Web.git   #Discuz! Q PC端代码\n")])])]),e("p",[i._v("首次部署执行以下命令：")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v("git clone git@gitee.com:Discuz/Discuz-Q.git dzq-dev\ncd dzq-dev\ngit clone  git@gitee.com:Discuz/Discuz-Q-Framework.git \nframework\n")])])]),e("p",[i._v("在 "),e("code",[i._v("dzq-dev")]),i._v(" 目录中新增 "),e("code",[i._v("public_1")]),i._v(" 与 "),e("code",[i._v("public_2")]),i._v("两个文件夹，并在设置如下值：")]),i._v(" "),e("ul",[e("li",[e("code",[i._v("public_1")]),i._v(" 中新增 "),e("code",[i._v("skin.conf")]),i._v(" 文件并写入 "),e("code",[i._v("1")]),i._v(" 值到文件中。")]),i._v(" "),e("li",[e("code",[i._v("public_2")]),i._v(" 中新增 "),e("code",[i._v("skin.conf")]),i._v(" 文件并写入 "),e("code",[i._v("2")]),i._v(" 值到文件中。")])]),i._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[i._v("TIP")]),i._v(" "),e("p",[i._v("安装项目依赖前必须安装 composer ,您可以使用命令 "),e("code",[i._v("composer install")]),i._v(" 进行安装。")])]),i._v(" "),e("p",[i._v("使用 "),e("code",[i._v("cd ../")]),i._v(" 回到 "),e("code",[i._v("dzq-dev")]),i._v(" 同级目录，使用 "),e("code",[i._v("clone")]),i._v(" 命令拉取前端代码。")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v("git clone  git@gitee.com:Discuz/Discuz-Q-uniapp discuz-uniapp\ngit clone  git@gitee.com:Discuz/Discuz-Q-Web.git discuz-web\n")])])]),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[i._v("TIP")]),i._v(" "),e("p",[i._v("以下的脚本执行需要安装 npm 环境。")])]),i._v(" "),e("p",[i._v("把以下脚本内容复制到 back.sh 文件中。")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v('#!/bin/bash\nexport PATH=$PATH:/usr/local/bin\n\nBASE="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"\n\ncd $BASE/dzq-dev\ngit pull origin master\n\ncd $BASE/dzq-dev/framework\ngit pull origin master\n\ncd $BASE/dzq-dev/resources/frame\n\nnpm install\nnpm run build-admin\nnpm run build-admin:pay\n\nrm -rf $BASE/dzq-dev/public_2/static-admin\ncp -r $BASE/dzq-dev/public_pay/* $BASE/dzq-dev/public_2/ \n\nrm -rf $BASE/dzq-dev/public_1/static-admin\ncp -r $BASE/dzq-dev/public/static-admin $BASE/dzq-dev/public_1/\ncp  $BASE/dzq-dev/public/admin.html $BASE/dzq-dev/public_1/\n')])])]),e("p",[i._v("把以下脚本内容复制到 H5.sh 文件中。")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v('#!/bin/bash\nexport PATH=$PATH:/usr/local/bin\n\nBASE="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"\n\ncd $BASE/discuz-uniapp\ngit pull origin master\n\nnpm install\necho ============build h5====================\nnpm run build:h5\necho ============build h5 play===============\nnpm run build:h5-play\n\necho =============delete static====================\nrm -rf $BASE/dzq-dev/public/static \nrm -rf $BASE/dzq-dev/public_1/static\nrm -rf $BASE/dzq-dev/public_2/static\n\necho ============copy dist to public===============\ncp -r $BASE/discuz-uniapp/dist/build/h5/* $BASE/dzq-dev/public/ \ncp -r $BASE/discuz-uniapp/dist/build/h5/* $BASE/dzq-dev/public_1/\ncp -r $BASE/discuz-uniapp/dist/build/h5-play/* $BASE/dzq-dev/public_2/\n')])])]),e("p",[i._v("把以下脚本内容复制到 pc.sh 文件中。")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v('#!/bin/bash\nexport PATH=$PATH:/usr/local/bin\n\nBASE="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )"\ncd $BASE/discuz-web/\ngit pull origin master\n\nnpm install\nnpm run  build:spa\nrm -rf $BASE/dzq-dev/public/invite \nrm -rf $BASE/dzq-dev/public/manage\nrm -rf $BASE/dzq-dev/public/modify\nrm -rf $BASE/dzq-dev/public/my\nrm -rf $BASE/dzq-dev/public/_nuxt\nrm -rf $BASE/dzq-dev/public/site\nrm -rf $BASE/dzq-dev/public/thread\nrm -rf $BASE/dzq-dev/public/topic\nrm -rf $BASE/dzq-dev/public/user\nmv dist/index.html dist/pc.html\ncp -r $BASE/discuz-web/dist/* $BASE/dzq-dev/public/\nrm -rf $BASE/dzq-dev/public_1/invite\nrm -rf $BASE/dzq-dev/public_1/manage\nrm -rf $BASE/dzq-dev/public_1/modify\nrm -rf $BASE/dzq-dev/public_1/my\nrm -rf $BASE/dzq-dev/public_1/_nuxt\nrm -rf $BASE/dzq-dev/public_1/site\nrm -rf $BASE/dzq-dev/public_1/thread\nrm -rf $BASE/dzq-dev/public_1/topic\nrm -rf $BASE/dzq-dev/public_1/user\ncp -r $BASE/discuz-web/dist/* $BASE/dzq-dev/public_1/\nrm -rf $BASE/discuz-web/dist\ncd $BASE/discuz-web/\nnpm run  build:pay-spa\nrm -rf $BASE/dzq-dev/public_2/invite\nrm -rf $BASE/dzq-dev/public_2/manage\nrm -rf $BASE/dzq-dev/public_2/modify\nrm -rf $BASE/dzq-dev/public_2/my\nrm -rf $BASE/dzq-dev/public_2/_nuxt\nrm -rf $BASE/dzq-dev/public_2/site\nrm -rf $BASE/dzq-dev/public_2/thread\nrm -rf $BASE/dzq-dev/public_2/topic\nrm -rf $BASE/dzq-dev/public_2/user\nmv dist/index.html dist/pc.html\ncp -r $BASE/discuz-web/dist/* $BASE/dzq-dev/public_2/\nrm -rf $BASE/discuz-web/dist\n')])])]),e("p",[i._v("把以上三个脚本文件"),e("code",[i._v("back.sh")]),i._v("、"),e("code",[i._v("H5.sh")]),i._v("、"),e("code",[i._v("pc.sh")]),i._v(" 放置与 "),e("code",[i._v("dzq-dev")]),i._v(" 文件同级目录下，并分别执行：")]),i._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[i._v("sh back.sh\nsh H5.sh\nsh pc.sh\n")])])]),e("p",[i._v("构建并组合好所有的代码后，需使用 "),e("code",[i._v("git clone git@gitee.com:Discuz/Discuz-Q-Update.git")]),i._v(" 下载命令执行文件。")]),i._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[i._v("TIP")]),i._v(" "),e("p",[i._v("若无权限，则需要从官方提供的安装包中，安装包 "),e("code",[i._v("/app/Console/Commands/Upgrades/")]),i._v(" 目录下复制所有的文件到项目目录"),e("code",[i._v("/app/Console/Commands/Upgrades/")]),i._v("下。")])]),i._v(" "),e("p",[i._v("此处就已完成全部代码整合，配置好 Nginx 服务后访问 "),e("code",[i._v("https://域名/install")]),i._v(" 即可安装站点。")]),i._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[i._v("DANGER")]),i._v(" "),e("p",[i._v("首次安装后，再次升级时，只需要执行 "),e("code",[i._v("back.sh")]),i._v("、"),e("code",[i._v("pc.sh")]),i._v("、"),e("code",[i._v("H5.sh")]),i._v("即可。数据迁移查看每个版本的命令，详情参见：\n"),e("a",{attrs:{href:"https://discuz.com/docs/%E5%B8%B8%E8%A7%84%E9%83%A8%E7%BD%B2%E5%8D%87%E7%BA%A7.html#%E6%89%8B%E5%8A%A8%E5%8D%87%E7%BA%A7%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer"}},[i._v("手动升级方式"),e("OutboundLink")],1),i._v("。")])])])}),[],!1,null,null,null);e.default=d.exports}}]);