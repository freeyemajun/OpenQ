(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{217:function(t,a,e){"use strict";e.r(a);var r=e(6),_=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"discuz-q-最佳部署实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#discuz-q-最佳部署实践"}},[t._v("#")]),t._v(" Discuz! Q  最佳部署实践")]),t._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("本文档将帮助中小 Discuz! Q 站长最大程度低成本、高安全、可靠地使用 Discuz! Q。")]),t._v(" "),a("h2",{attrs:{id:"痛点说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#痛点说明"}},[t._v("#")]),t._v(" 痛点说明")]),t._v(" "),a("ul",[a("li",[t._v("个人无技术背景或中小企业无相关技术人员支持，在选购云服务时无法根据用户量和实际情况进行选择。")]),t._v(" "),a("li",[t._v("对 Discuz! Q 各项云服务功能和使用场景不了解。")]),t._v(" "),a("li",[t._v("对各项安全设置不能进行系统评估。")]),t._v(" "),a("li",[t._v("对 Discuz! Q 使用的架构不熟悉，导致无法对 Discuz! Q 进行性能调优提高用户体验和降低成本。")])]),t._v(" "),a("h2",{attrs:{id:"评估系统容量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#评估系统容量"}},[t._v("#")]),t._v(" 评估系统容量")]),t._v(" "),a("p",[t._v("容量规划在互联网发展初期是一个非常重要的工作，主要的原因在于用户量较低时，过高配置将提高成本支出。当用户量激增时，服务器容量较小或扩容较为困难，您需要重新购买一台物理服务器，从部署到正式上线，其中需要的时间可能长达数周，期间影响用户体验，容易导致用户流失。\n随着云计算行业的发展，服务器已经像水电等基础设施一样，可以按需付费、灵活部署、释放资源。这可使容量规划的重要性大大降低，在上线初期您可根据参考值进行选择，不用担心后续升降配置带来的风险，灵活扩展的同时，也可显著的降低成本。")]),t._v(" "),a("p",[t._v("本文提供了两种云服务部署 Discuz! Q 方案，您可根据实际情况和需求进行选择：")]),t._v(" "),a("h2",{attrs:{id:"使用开源应用中心一键部署-推荐"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用开源应用中心一键部署-推荐"}},[t._v("#")]),t._v(" 使用开源应用中心一键部署（推荐）")]),t._v(" "),a("p",[t._v("腾讯云 "),a("a",{attrs:{href:"https://app.cloud.tencent.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("开源应用中心"),a("OutboundLink")],1),t._v(" 正式部署 Discuz! Q  实现了高可靠、高性能、低成本的解决方案，推荐站长们使用。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://app.cloud.tencent.com/"}},[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/9c9887d61990b24d24ecfba87fa10852.png"}})])]),t._v(" "),a("p",[t._v("开源应用中心正式开通 Discuz! Q 应用实例依托于云开发 CloudBase 以及相关云资源进行部署，部署过程中将会在当前账号下拉取或创建相关云资源。如下：")]),t._v(" "),a("h4",{attrs:{id:"云托管"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云托管"}},[t._v("#")]),t._v(" 云托管")]),t._v(" "),a("p",[t._v("其原理在于弹性扩缩容：")]),t._v(" "),a("ul",[a("li",[t._v("无用户访问时，自动进入停机不收费模式，仅收取存储费用。大部分用户 Discuz! Q 站点，静态存储到文件存储 CFS 一年的费用约为是5元。")]),t._v(" "),a("li",[t._v("少量用户访问，使用最小核心数。例如，Discuz! Q 站点只有5人同时在线，使用0.25核、0.2GiB内存、0.2GB流量、低成本模式运行、计算成本约为0.04元/小时。")]),t._v(" "),a("li",[t._v("集群化部署。大并发访问时，自动扩容，满足用户流量的激增，不降低用户体验。小流量时自动缩容，使用更便捷，成本更低。")])]),t._v(" "),a("h4",{attrs:{id:"示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("p",[t._v("对于大部分中小型站点，以一个小型 Discuz! Q 站点为例：")]),t._v(" "),a("ul",[a("li",[t._v("凌晨0点 - 9点，无用户访问，自动缩容到0，无任何费用。")]),t._v(" "),a("li",[t._v("10点 - 20点，大部分人上班，论坛小核心低速使用，相当于使用了2.5核*10个小时。")]),t._v(" "),a("li",[t._v("20点 - 24点，高峰期，扩容到2核4GiB内存使用，相当于8核*4小时。")])]),t._v(" "),a("p",[t._v("云托管详细价格说明参见："),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/1243/47823",target:"_blank",rel:"noopener noreferrer"}},[t._v("产品定价"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"云原生数据库-tdsql-c-cynosdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云原生数据库-tdsql-c-cynosdb"}},[t._v("#")]),t._v(" 云原生数据库 TDSQL-C（cynosdb）")]),t._v(" "),a("p",[t._v("同样，腾讯云开源应用中心使用的云原生数据库 TDSQL-C（cynosdb）也是弹性自动扩容，数据库的消耗如下：")]),t._v(" "),a("ul",[a("li",[t._v("无用户访问时，自动进入停机不收费模式，仅收取存储费用，大部分用户站点，存储费用可以忽略。")]),t._v(" "),a("li",[t._v("少量用户访问，使用最小核心数，例如，站点只有5人同时在线，使用0.25核，0.5GiB内存。")]),t._v(" "),a("li",[t._v("集群化部署。大并发访问时，自动扩容，满足用户流量的激增，不降低用户体验。小流量时自动缩容，用户使用更便捷、成本更低。")])]),t._v(" "),a("h4",{attrs:{id:"示例-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-2"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("p",[t._v("对于大部分中小型站点，以一个小型 Discuz! Q 站点为例：")]),t._v(" "),a("ul",[a("li",[t._v("凌晨 0点 - 9点，无用户访问，自动缩容到0，无任何费用。")]),t._v(" "),a("li",[t._v("10点 - 20点，大部分人上班，论坛小核心低速使用，对应的资源是2.5CCU量。")]),t._v(" "),a("li",[t._v("20点 - 24点，论坛扩容到1核2GiB内存使用，对应的资源是4CCU量。")])]),t._v(" "),a("p",[t._v("一天的总体成本约为6.5CCU量，按照优惠价7元/45CCU计算，则一个月成本是30.3元，使用30.3元成本即可达到（1C2GiB）的云数据库体验。")]),t._v(" "),a("p",[t._v("云原生数据库 TDSQL-C 详细价格说明参见："),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/1003/30493",target:"_blank",rel:"noopener noreferrer"}},[t._v("计费概述"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"文件存储-cloud-file-storage-cfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件存储-cloud-file-storage-cfs"}},[t._v("#")]),t._v(" 文件存储（Cloud File Storage，CFS）")]),t._v(" "),a("p",[t._v("文件存储（Cloud File Storage，CFS）提供了可扩展的共享文件存储服务，可与腾讯云的 CVM 、容器、批量计算等服务搭配使用。CFS 提供了标准的 NFS 及 CIFS/SMB 文件系统访问协议，为多个 CVM 实例或其他计算服务提供共享的数据源，支持弹性容量和性能的扩展，现有应用无需修改即可挂载使用，是一种高可用、高可靠的分布式文件系统。")]),t._v(" "),a("h4",{attrs:{id:"示例-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-3"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("p",[t._v("以一个中小型 Discuz! Q 站点为例。如果经常发布一些包含有图片、背景音乐、视频的文章，同时还有软件下载区等。")]),t._v(" "),a("p",[t._v("如：使用中国大陆文件存储标准存储按量计费模式，每月预计占用标准存储容量100GiB。")]),t._v(" "),a("p",[t._v("则每约预估存储空间费用：0.35元/GiB/月 × 100GiB  = 35元")]),t._v(" "),a("p",[t._v("文件存储详细价格说明参见："),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/582/47378",target:"_blank",rel:"noopener noreferrer"}},[t._v("计费概述"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"对象存储-cloud-object-storage-cos"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对象存储-cloud-object-storage-cos"}},[t._v("#")]),t._v(" 对象存储（Cloud Object Storage，COS）")]),t._v(" "),a("p",[t._v("对象存储（Cloud Object Storage，COS）是腾讯云提供的一种存储海量文件的分布式存储服务，具有高扩展性、低成本、可靠安全等优点。您可简单、快速地接入 COS，进行多格式文件的上传、下载和管理，实现海量数据存储和管理。")]),t._v(" "),a("h4",{attrs:{id:"示例-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-4"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("p",[t._v("对于大部分中小型站点，以一个中小型 Discuz! Q 站点为例。如果经常发布一些包含有图片、背景音乐、视频的文章，同时还有软件下载区等。并将网站内容存储在"),a("strong",[t._v("广州地域")]),t._v("的"),a("strong",[t._v("标准存储")]),t._v("服务中。")]),t._v(" "),a("p",[t._v("如：每月预计占用标准存储容量50G，和写请求总计100万次。")]),t._v(" "),a("p",[t._v("则在不享有的免费额度情况下，每月的费用分析如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("费用组成")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("免费额度")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("单价")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("计费量")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("费用（单价 * 计费量）")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("存储容量费用")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0.118元/GB/月")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("50GB")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("5.9元")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("请求费用")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0.01元/万次")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("100万次")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1元")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("月费用")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("-")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("6.9元")])])])])]),t._v(" "),a("p",[t._v("对象存储详细价格说明参见："),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/582/47378",target:"_blank",rel:"noopener noreferrer"}},[t._v("计费概述"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("因此，使用开源应用中心部署方案，整体成本可以下降80%而对用户的体验影响较小。")]),t._v(" "),a("h4",{attrs:{id:"云点播-video-on-demand-vod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云点播-video-on-demand-vod"}},[t._v("#")]),t._v(" 云点播（Video on Demand，VOD）")]),t._v(" "),a("p",[t._v("云点播（Video on Demand，VOD）是腾讯云提供的一种云端一体化的音视频点播服务平台，可以提供低延迟、高画质、高码率、多终端和视频安全等多种业务场景。您可以便捷的接入云点播服务平台，对音视频内容进行管理、处理和分发播放。")]),t._v(" "),a("h4",{attrs:{id:"示例-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例-5"}},[t._v("#")]),t._v(" 示例：")]),t._v(" "),a("p",[t._v("对于大部分 Discuz！Q 站点，无论是付费站点或者免费站点，音视频能力都是站点中不可缺少的一部分，音视频文件的存储和播放都是业务亟待解决的问题。")]),t._v(" "),a("p",[t._v("以一个小型 Discuz! Q 站点为例：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("br"),t._v("费用组成")]),t._v(" "),a("th",[a("br"),t._v("单价")]),t._v(" "),a("th",[a("br"),t._v("计费量")]),t._v(" "),a("th",[a("br"),t._v("费用（单价*计费量）")]),t._v(" "),a("th",[a("br"),t._v("降冷后费用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("br"),t._v("存储容量费用")]),t._v(" "),a("td",[a("br"),t._v("0.0048元/GB/日")]),t._v(" "),a("td",[a("br"),t._v("50GB")]),t._v(" "),a("td",[a("br"),t._v("7.2元")]),t._v(" "),a("td",[a("br"),t._v("3.6元")])]),t._v(" "),a("tr",[a("td",[a("br"),t._v("转码费用")]),t._v(" "),a("td",[a("br"),t._v("0.016元/分钟")]),t._v(" "),a("td",[a("br"),t._v("5小时")]),t._v(" "),a("td",[a("br"),t._v("4.8元")]),t._v(" "),a("td",[a("br"),t._v("4.8元")])]),t._v(" "),a("tr",[a("td",[a("br"),t._v("播放费用")]),t._v(" "),a("td",[a("br"),t._v("0.24元/GB")]),t._v(" "),a("td",[a("br"),t._v("25GB")]),t._v(" "),a("td",[a("br"),t._v("6元")]),t._v(" "),a("td",[a("br"),t._v("6元")])]),t._v(" "),a("tr",[a("td",[a("br"),t._v("月费用")]),t._v(" "),a("td",[a("br"),t._v("-")]),t._v(" "),a("td",[a("br"),t._v("-")]),t._v(" "),a("td",[a("br"),t._v("18元")]),t._v(" "),a("td",[a("br"),t._v("14.4")])])])]),t._v(" "),a("p",[t._v("合理购买和使用"),a("strong",[t._v("资源包")]),t._v("和点播的"),a("strong",[t._v("智能降冷")]),t._v("特性价格能"),a("strong",[t._v("有效帮助用户降低50%的成本")]),t._v("，详细请参考云点播"),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/266/2838",target:"_blank",rel:"noopener noreferrer"}},[t._v("计费概述"),a("OutboundLink")],1),t._v("和 如何将点播的媒体文件进行"),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/266/56196#.E5.AD.98.E5.82.A8.E7.B1.BB.E5.9E.8B.3Ca-id.3D.22type.22.3E.3C.2Fa.3E",target:"_blank",rel:"noopener noreferrer"}},[t._v("智能降冷"),a("OutboundLink")],1),t._v(" 。")]),t._v(" "),a("h3",{attrs:{id:"购买资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#购买资源"}},[t._v("#")]),t._v(" 购买资源")]),t._v(" "),a("p",[t._v("根据以上资源说明，对于中小型 Discuz! Q 站点推荐以下购买方案：")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("该购买方案需使用对象存储能力，需在 Discuz! Q 站点管理后台开启对象存储功能。详情操作参见："),a("a",{attrs:{href:"https://discuz.com/manual-admin/2.html#_2-7-6-%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8",target:"_blank",rel:"noopener noreferrer"}},[t._v("开启对象存储"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("若您需使用云点播能力 ，需在 Discuz! Q 站点管理后台开启云点播功能。详情操作参见："),a("a",{attrs:{href:"https://discuz.com/docs/%E4%BA%91%E7%82%B9%E6%92%AD%E8%AE%BE%E7%BD%AE.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("开启云点播"),a("OutboundLink")],1),t._v("。")])])])]),t._v(" "),a("h4",{attrs:{id:"云托管资源包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云托管资源包"}},[t._v("#")]),t._v(" 云托管资源包")]),t._v(" "),a("p",[t._v("因使用对象存储能力，可有效降低云托管流量需求，推荐购买"),a("strong",[t._v("720核*小时、流量：30 GB")]),t._v(" 低流量云托管资源包 ，对比按量付费成本更低。该云托管资源包可以使用约2.3个月，每月45元成本即可达到（2C 4G 5Mbps）的云服务器 CVM 体验。购买资源包详细操作参见："),a("a",{attrs:{href:"https://discuz.com/docs/%E8%B4%AD%E4%B9%B0%E8%B5%84%E6%BA%90%E5%8C%85.html#%E6%A6%82%E8%BF%B0",target:"_blank",rel:"noopener noreferrer"}},[t._v("资源包购买"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"云原生数据库-tdsql-c"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云原生数据库-tdsql-c"}},[t._v("#")]),t._v(" 云原生数据库 TDSQL-C")]),t._v(" "),a("p",[t._v("云原生数据库 TDSQL-C，无资源包，使用按量计费模式。")]),t._v(" "),a("h4",{attrs:{id:"云点播资源包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#云点播资源包"}},[t._v("#")]),t._v(" 云点播资源包")]),t._v(" "),a("p",[t._v("推荐购买云点播资源包如下，可满足中小型 Discuz！Q 大部分情况下基本资源需求：")]),t._v(" "),a("ul",[a("li",[t._v("云点播体验包（新用户推荐）：含 10GB 流量 + 20GB存储 + 100分钟普通砖吗 + 30分钟极速高清转码 + 100分钟视频审核时长。")]),t._v(" "),a("li",[t._v("云点播流量包100GB。")]),t._v(" "),a("li",[t._v("云点播存储包50GB。")]),t._v(" "),a("li",[t._v("云点播转码包5小时。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("登录并访问 "),a("a",{attrs:{href:"https://cloud.tencent.com/act/event/discuzq",target:"_blank",rel:"noopener noreferrer"}},[t._v("Discuz! Q 活动页"),a("OutboundLink")],1),t._v("，在购福利处，购买您需要的点播资源包。更多资源包请关注"),a("a",{attrs:{href:"https://discuz.com/docs/%E8%B4%AD%E4%B9%B0%E8%B5%84%E6%BA%90%E5%8C%85.html#%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97",target:"_blank",rel:"noopener noreferrer"}},[t._v("点播资源包购买"),a("OutboundLink")],1),t._v(" 。")])]),t._v(" "),a("h4",{attrs:{id:"对象存储资源包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对象存储资源包"}},[t._v("#")]),t._v(" 对象存储资源包")]),t._v(" "),a("p",[t._v("推荐购买对象存储资源包组合如下，可满足中小型 Discuz! Q 大部分情况下基本资源需求：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("存储容量：标准存储容量包 50GB。")])]),t._v(" "),a("li",[a("p",[t._v("流量：外网下行流量包 50G。")])]),t._v(" "),a("li",[a("p",[t._v("读写请求：标准存储请求包 100万次。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("购买资源包详细操作参见："),a("a",{attrs:{href:"https://discuz.com/docs/%E8%B4%AD%E4%B9%B0%E8%B5%84%E6%BA%90%E5%8C%85.html#%E6%A6%82%E8%BF%B0",target:"_blank",rel:"noopener noreferrer"}},[t._v("资源包购买"),a("OutboundLink")],1),t._v("，或通过 Discuz! Q "),a("a",{attrs:{href:"https://cloud.tencent.com/act/event/discuzq",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网活动页"),a("OutboundLink")],1),t._v("直接购买，价格更低，更实惠。")])]),t._v(" "),a("h4",{attrs:{id:"文件存储-cloud-file-storage-cfs-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件存储-cloud-file-storage-cfs-2"}},[t._v("#")]),t._v(" 文件存储（Cloud File Storage，CFS）")]),t._v(" "),a("p",[t._v("以上对象存储资源包中已包含存储容量，文件存储需求降低，推荐使用按量计费模式使用资源。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("使用开源应用中心一键部署 Discuz! Q 详细操作参见："),a("a",{attrs:{href:"https://discuz.com/docs/%E5%BC%80%E6%BA%90%E5%BA%94%E7%94%A8%E4%B8%AD%E5%BF%83%E5%AE%89%E8%A3%85.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("开源应用中心安装 Discuz! Q"),a("OutboundLink")],1),t._v(" 。")])]),t._v(" "),a("h2",{attrs:{id:"私有化部署-cvm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#私有化部署-cvm"}},[t._v("#")]),t._v(" 私有化部署（CVM）")]),t._v(" "),a("p",[t._v("如果您使用自己购买包年包月的云服务器 CVM 搭建 Discuz! Q 服务，您可参考以下数据来选择合适的服务器配置，更大的站点推荐使用集群配置方案。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("受限于数据时效性差异，该数据仅供参考。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("最大在线用户数量")]),t._v(" "),a("th",[t._v("帖子规模（含回复）")]),t._v(" "),a("th",[t._v("同时发帖回复")]),t._v(" "),a("th",[t._v("推荐配置")]),t._v(" "),a("th",[t._v("云数据库配置")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("50人")]),t._v(" "),a("td",[t._v("500 - 5000")]),t._v(" "),a("td",[t._v("5个")]),t._v(" "),a("td",[t._v("1c2g")]),t._v(" "),a("td",[t._v("使用本地数据库")])]),t._v(" "),a("tr",[a("td",[t._v("1000人")]),t._v(" "),a("td",[t._v("20000 - 200000")]),t._v(" "),a("td",[t._v("100个")]),t._v(" "),a("td",[t._v("4c8g")]),t._v(" "),a("td",[t._v("2c4g")])])])]),t._v(" "),a("h3",{attrs:{id:"采购设备-完成基本配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#采购设备-完成基本配置"}},[t._v("#")]),t._v(" 采购设备，完成基本配置")]),t._v(" "),a("p",[t._v("个人无技术背景的站长或无技术支持的企业，推荐您使用 "),a("a",{attrs:{href:"https://discuz.com/docs/%E5%BC%80%E6%BA%90%E5%BA%94%E7%94%A8%E4%B8%AD%E5%BF%83%E5%AE%89%E8%A3%85.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("开源应用中心"),a("OutboundLink")],1),t._v(" 的 Discuz! Q  一键开通方式，该方案无需站长进行复杂配置，并且性能最优，成本最低。")]),t._v(" "),a("p",[t._v("由于 Discuz! Q 开发和测试时，使用的服务器均为腾讯云。腾讯云对应的服务器和操作系统能够很好的支持 Discuz! Q。")]),t._v(" "),a("p",[t._v("如果您需以云服务器 CVM 方式搭建，推荐您使用腾讯云云服务器 CVM。操作系统版本推荐使用 CentOS 7.6 或 CentOS 8.0，PHP 环境推荐 7.2、7.3、7.4 版本。购买云服务器可参考 "),a("a",{attrs:{href:"https://cloud.tencent.com/product/cvm",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯云云服务器 CVM"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"购买-cvm-与操作系统选型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#购买-cvm-与操作系统选型"}},[t._v("#")]),t._v(" 购买 CVM 与操作系统选型")]),t._v(" "),a("ul",[a("li",[t._v("CVM 选型时，建议优先选择用户主要分布的地域，例如，您的 Discuz! Q  站点的主要用户群体在北京，建议选择北京地域的 CVM，可提高网络性能，降低延迟。")]),t._v(" "),a("li",[t._v("CVM 对应的操作系统，推荐使用 CentOS 7.6 和 CentOS 8，Discuz! Q  开发人员主要使用这两种环境来做自验证，验证的较多，稳定、可靠性更高。")]),t._v(" "),a("li",[t._v("如果您使用腾讯云云服务器 CVM ，可以直接选择腾讯云市场免费提供的 Discuz! Q  镜像，一键安装，完成所有的配置优化工作。\n具体可参见 "),a("a",{attrs:{href:"https://discuz.com/docs/%E8%85%BE%E8%AE%AF%E4%BA%91%E5%AE%89%E8%A3%85.html#%E9%95%9C%E5%83%8F-%E6%8E%A8%E8%8D%90",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯云镜像安装部署 Discuz! Q"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"购买数据盘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#购买数据盘"}},[t._v("#")]),t._v(" 购买数据盘")]),t._v(" "),a("h4",{attrs:{id:"使用-ssd-有什么好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-ssd-有什么好处"}},[t._v("#")]),t._v(" 使用 SSD 有什么好处？")]),t._v(" "),a("p",[t._v("Discuz! Q 目前通过对帖子数据进行缓存，以降低数据库资源占用，改善访问性能。目前支持的缓存介质是磁盘，使用 SSD，相比普通的磁盘性能提升接近一倍 IO 吞吐量。具体可参见 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/362/2353",target:"_blank",rel:"noopener noreferrer"}},[t._v("云硬盘类型"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("如果预算充足，推荐购买腾讯云 SSD 硬盘，将 Discuz! Q 安装在 SSD 磁盘分区，预可以较大提升接口性能。")]),t._v(" "),a("li",[t._v("如果预算一般，可以购买独立的高性能磁盘，DiscuzQ 和操作系统盘分离、更可靠、稳定。")])]),t._v(" "),a("h3",{attrs:{id:"购买云数据库-使用内网访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#购买云数据库-使用内网访问"}},[t._v("#")]),t._v(" 购买云数据库，使用内网访问")]),t._v(" "),a("h4",{attrs:{id:"为什么需要使用云数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要使用云数据库"}},[t._v("#")]),t._v(" 为什么需要使用云数据库？")]),t._v(" "),a("p",[t._v("数据库本地安装，很容易和 Discuz! Q 的 PHP 程序争抢本地资源（CPU/内存/磁盘），导致性能劣化。未经过调优的 MySQL，会导致云服务器 CVM 资源紧张，降低程序性能，导致 1+1 < 2 现象。")]),t._v(" "),a("ul",[a("li",[t._v("预算充足，用户数量较多，推荐使用分布式数据库 TDSQL。多数据分区分表，支持上千亿条数据和高并发访问。")]),t._v(" "),a("li",[t._v("普通站点，推荐使用云数据库。")]),t._v(" "),a("li",[t._v("低配站点，可以使用数据库本地部署，本地部署使用 "),a("code",[t._v("127.0.0.1")]),t._v(" 或 "),a("code",[t._v("localhost")]),t._v(" 环回访问可以获得最大的访问性能。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("数据库与腾讯云 CVM 建议部署在一个VPC 中，将可达到最大化性能表现。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/e41d7492581686fd58a6efba08ec7d6f.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"购买对象存储-cos-存储桶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#购买对象存储-cos-存储桶"}},[t._v("#")]),t._v(" 购买对象存储 COS 存储桶")]),t._v(" "),a("h4",{attrs:{id:"为什么要使用对象存储-cos-存储桶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要使用对象存储-cos-存储桶"}},[t._v("#")]),t._v(" 为什么要使用对象存储 COS 存储桶?")]),t._v(" "),a("ul",[a("li",[t._v("性能更好。用户浏览 Discuz! Q  站点时，如果使用了对象存储 COS，内容资源的获取使用的是对象存储 COS 的带宽，性能更好更稳定，将云服务器 CVM 的带宽用来获取 API 数据，10Mbps 可以提供日活2万用户的 Discuz! Q 站点使用。\n"),a("img",{attrs:{src:"https://main.qcloudimg.com/raw/b3d3adc3a21b25699a6310a497c5e2ac.png",alt:""}})]),t._v(" "),a("li",[t._v("成本更低。同样的数据量，对象存储 COS 的成本只有云硬盘 CBS 的1/3。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("腾讯云对象存储 COS 针对个人用户赠送免费额度50GB的标准存储容量，企业用户 1TB 标准存储容量。具体可参见 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/436/6240",target:"_blank",rel:"noopener noreferrer"}},[t._v("对象存储 COS 免费额度"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"完成基础环境部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#完成基础环境部署"}},[t._v("#")]),t._v(" 完成基础环境部署")]),t._v(" "),a("p",[t._v("环境部署您可以参见以下方式进行部署：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://discuz.com/docs/%E5%BC%80%E6%BA%90%E5%BA%94%E7%94%A8%E4%B8%AD%E5%BF%83%E5%AE%89%E8%A3%85.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("开源应用中心安装（推荐）"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("购买 CVM 部署安装：\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://discuz.com/docs/Linux%20%E4%B8%BB%E6%9C%BA.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux 主机安装"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://discuz.com/docs/Windows%20%E4%B8%BB%E6%9C%BA.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Windows 主机安装"),a("OutboundLink")],1)])])])]),t._v(" "),a("h2",{attrs:{id:"安全配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全配置"}},[t._v("#")]),t._v(" 安全配置")]),t._v(" "),a("h3",{attrs:{id:"密码配置策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#密码配置策略"}},[t._v("#")]),t._v(" 密码配置策略")]),t._v(" "),a("p",[t._v("配置密码字符类型提高密码难度。进入 DiscuzQ 站点后台 ->【全局】->【注册与登录设置】->【密码字符类型】中建议勾选所有密码类型。如下图所示：")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("密码最小长度设置为6或者更多，密码字符类型应该至少勾选：数字、小写字母和符号三种。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/87be1e7fdab82a868623da11c5832e25.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"web-应用防火墙-waf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-应用防火墙-waf"}},[t._v("#")]),t._v(" Web 应用防火墙 (WAF)")]),t._v(" "),a("h4",{attrs:{id:"为什么使用-web-应用防火墙-waf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用-web-应用防火墙-waf"}},[t._v("#")]),t._v(" 为什么使用 Web 应用防火墙（WAF）？")]),t._v(" "),a("p",[t._v("Web 应用防火墙（WAF）可以通过清洗流量，来显著提升站点的安全性，具体可参见 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/627/17470",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web 应用防火墙（WAF）"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"短信验证码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#短信验证码"}},[t._v("#")]),t._v(" 短信验证码")]),t._v(" "),a("p",[t._v("通过配置短信验证码，可以避免用户恶意注册和恶意发帖，具体可参见 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/382",target:"_blank",rel:"noopener noreferrer"}},[t._v("短信产品文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"安全合规配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全合规配置"}},[t._v("#")]),t._v(" 安全合规配置")]),t._v(" "),a("h4",{attrs:{id:"为什么使用腾讯文本内容安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用腾讯文本内容安全"}},[t._v("#")]),t._v(" 为什么使用腾讯文本内容安全？")]),t._v(" "),a("p",[t._v("中国境内服务器如果不进行相应的内容审核，会导致站点或域名被封禁，以及站点不可正常使用。使用腾讯云的敏感词功能，可以降低站长的审核负担，提升用户发帖体验，Discuz! Q  目前支持三种文本内容安全的检查方式，包含：")]),t._v(" "),a("ul",[a("li",[t._v("本地敏感词检测（免费，依赖用户手工录入的敏感词）。")]),t._v(" "),a("li",[t._v("小程序敏感词检测（免费）。")]),t._v(" "),a("li",[t._v("腾讯云敏感词检测（付费）。")])]),t._v(" "),a("p",[t._v("默认的检查逻辑如下：")]),t._v(" "),a("ol",[a("li",[t._v("先检查本地敏感词，检查是否触发，需要在管理后台导入敏感词。您可以使用该词库进行导入 "),a("a",{attrs:{href:"https://discuz.chat/thread/15140",target:"_blank",rel:"noopener noreferrer"}},[t._v("敏感词"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("li",[t._v("如果您开启腾讯云敏感词检测，则使用腾讯云敏感词检测功能检查内容，需要在 "),a("a",{attrs:{href:"https://console.cloud.tencent.com/cms/text/package",target:"_blank",rel:"noopener noreferrer"}},[t._v("腾讯云控制台"),a("OutboundLink")],1),t._v(" 打开文本内容安全功能，并在 Discuz! Q 后台进行配置。")]),t._v(" "),a("li",[t._v("如果没有开启腾讯云检测，并且站点有小程序功能，则使用小程序敏感词检测。")])]),t._v(" "),a("h4",{attrs:{id:"为什么使用腾讯云图片内容安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么使用腾讯云图片内容安全"}},[t._v("#")]),t._v(" 为什么使用腾讯云图片内容安全？")]),t._v(" "),a("p",[t._v("主要用于审核图片，该业务使用和文本内容安全类似，也需要先在腾讯云控制台开启图片内容安全服务，而后在 Discuz! Q 后台开启。")]),t._v(" "),a("ul",[a("li",[t._v("购买内容安全套餐包，如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/9e864f53c274363759c77f0e5a3c2f5c.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("Discuz! Q  后台配置，如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/054621c850ca59290f5cf0de78c81192.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"安全配置【红包与悬赏】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全配置【红包与悬赏】"}},[t._v("#")]),t._v(" 安全配置【红包与悬赏】")]),t._v(" "),a("p",[t._v("验证回复开启手机号验证机制，防止恶意刷评论或抢红包。")]),t._v(" "),a("ol",[a("li",[t._v("登录 Discuz! Q 站点后台。依次单击【用户】->【用户角色】，在需要设置的用户角色处，单击【设置】。如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/0eceb8ad1cb4e5152f7fee01ee1a5df1.png",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("在用户角色页，单击【安全设置】页签，即可配置。如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/76f430609aaf36cdb5de76fc4953dd80.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"ddos-接入【推荐大型站点】"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ddos-接入【推荐大型站点】"}},[t._v("#")]),t._v(" DDOS 接入【推荐大型站点】")]),t._v(" "),a("p",[t._v("接入腾讯云 DDOS ，拒绝 DDOS 服务式攻击访问。具体可参见 "),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/1021/43890",target:"_blank",rel:"noopener noreferrer"}},[t._v("DDOS 产品文档"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("若您使用开源应用中心部署方式，无需进行以下配置。")])]),t._v(" "),a("h3",{attrs:{id:"主机安全云云镜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机安全云云镜"}},[t._v("#")]),t._v(" 主机安全云云镜")]),t._v(" "),a("p",[t._v("开启腾讯云云服务器 CVM 的云镜功能，云镜会自动扫描服务器，检查是否存在 webshell 木马。\n在服务器终端中，输入以下命令进行安装。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("wget http://u.yd.tencentyun.com/ydeyes_linux64.tar.gz -O ydeyes_linux64.tar.gz && tar -zxvf ydeyes_linux64.tar.gz && ./self_cloud_install_linux64.sh\n")])])]),a("p",[t._v("执行命令："),a("code",[t._v("ps -ef | grep YD")]),t._v(" 即可查看 YDService与 YDLive 进程是否在运行中，如果有在运行中则安装成功。")]),t._v(" "),a("h3",{attrs:{id:"运维部署权限控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运维部署权限控制"}},[t._v("#")]),t._v(" 运维部署权限控制")]),t._v(" "),a("p",[t._v("使用低权限用户运行 "),a("code",[t._v("nginx/php")]),t._v("，防止越权访问。例如 "),a("code",[t._v("www")]),t._v(" 等。")]),t._v(" "),a("h3",{attrs:{id:"管理端白名单-ip-访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理端白名单-ip-访问"}},[t._v("#")]),t._v(" 管理端白名单 IP 访问")]),t._v(" "),a("p",[t._v("通过在 Nginx 中配置 IP 白名单，禁止未授权用户访问：")]),t._v(" "),a("ol",[a("li",[t._v("在 Nginx 的 "),a("code",[t._v("conf")]),t._v(" 配置目录中，新增文件："),a("code",[t._v("dzq_ip.conf")]),t._v(" 文件，内容（示例）如下：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 每一行一个 ip\nallow 191.11.22.33;\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Nginx 配置文件 "),a("code",[t._v("nginx.conf")]),t._v(" 中，新增如下内容：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location /static-admin/ {\n    # 此处改为上一步中添加的 dzq_ip.conf 文件的实际路径\n    include /usr/service/nginx/conf/dzq_ip.conf;\n    deny all;\n    try_files $uri $uri/ /index.php?$query_string;\n}\nlocation /admin/ {\n    # 此处改为上一步中添加的 dzq_ip.conf 文件的实际路径\n    include /usr/service/nginx/conf/dzq_ip.conf;\n    deny all;\n    try_files $uri $uri/ /index.php?$query_string;\n}\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("重新加载 Nginx 配置或重启 Nginx。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("您可以使用 "),a("code",[t._v("nginx -t")]),t._v(" 检测配置文件是否有错误，无错误后可执行 "),a("code",[t._v("nginx -s reload")]),t._v(" 重新加载 Nginx 配置。")])]),t._v(" "),a("h2",{attrs:{id:"性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[t._v("#")]),t._v(" 性能优化")]),t._v(" "),a("h4",{attrs:{id:"cos-存储桶开启-cdn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cos-存储桶开启-cdn"}},[t._v("#")]),t._v(" COS 存储桶开启 CDN")]),t._v(" "),a("p",[t._v("COS 存储中开启 CDN 加速域名，可以让 COS 的访问直接通过 CDN 进行，加速 COS 资源访问速度。如下图所示:")]),t._v(" "),a("ul",[a("li",[t._v("腾讯云 COS 对象存储配置，如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/12799442a2aa69444a94810e75cda9b2.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("DiscuzQ 后台配置，如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/f7725dccfe08e63050a0426959527597.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"cdn-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cdn-部署"}},[t._v("#")]),t._v(" CDN 部署")]),t._v(" "),a("ol",[a("li",[t._v("登录 "),a("a",{attrs:{href:"https://console.cloud.tencent.com/cdn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("CDN 控制台"),a("OutboundLink")],1),t._v("。对全站开启 CDN 加速，腾讯云 CDN 配置。如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/9a1591ca2dd5b80ebf8bcf641813fe8c.png",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("在【缓存配置】>【节点缓存过期配置】处增加以下两条规则：")])]),t._v(" "),a("ul",[a("li",[t._v("规则类型为【文件目录】，内容设置为 "),a("code",[t._v("/apiv3")]),t._v("，缓存选项选择【不缓存】。")]),t._v(" "),a("li",[t._v("规则类型为【文件目录】，内容设置为 "),a("code",[t._v("/api")]),t._v("，缓存选项选择【不缓存】。优先级调整为“最顶部”。如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/d844a04160902335c5d8ac2a26845a01.png",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("配置优先级。在缓存配置页面调整优先级为最高。如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/ca305246f7c7d30018af12018e86547c.png",alt:""}})]),t._v(" "),a("h4",{attrs:{id:"cdn-打开-https-和-http2-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cdn-打开-https-和-http2-服务"}},[t._v("#")]),t._v(" CDN 打开 https 和 http2 服务")]),t._v(" "),a("p",[t._v("CDN 部署后可打开 https 和 http2 服务。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/dfcd6efd01198e39ad656c0e157e3c85.png",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("若您使用开源应用中心部署方式，无需进行以下配置。")])]),t._v(" "),a("h3",{attrs:{id:"如何快速界定性能问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何快速界定性能问题"}},[t._v("#")]),t._v(" 如何快速界定性能问题？")]),t._v(" "),a("p",[t._v("目前 Discuz! Q 提供了观测接口，您可通过接口快速判断是否因为网络问题导致网站性能较差，如下图所示：")]),t._v(" "),a("ul",[a("li",[t._v("thread.list 接口 time 字段，如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/2653cb8b4bb2dcbc6356aeb1b65f1dde.png",alt:""}})]),t._v(" "),a("ul",[a("li",[t._v("thread.list 接口 dzq-costtime 字段，如下图所示：")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/4d06486c92e8330d2b4a0b6c0ac41acd.png",alt:""}})]),t._v(" "),a("p",[t._v("上述接口中，thread.list 接口延迟是 113ms，dzq-costtime 为 93ms，实际网络传输是 20ms（113-93 = 20），可以得出如下结论：")]),t._v(" "),a("ul",[a("li",[t._v("网络比较通畅，延迟仅 20ms，如果延迟超过 100ms，需要检查网络带宽，或对网络进行性能优化。")]),t._v(" "),a("li",[t._v("机器负载比较小，接口响应是 93ms，如果接口响应超过 500ms，需要检查机器负载，对机器性能进行优化。一般情况下常见的机器压力由以下几个原因导致：\n"),a("ul",[a("li",[t._v("CPU 压力过大,调整 CPU 的核心数量。")]),t._v(" "),a("li",[t._v("磁盘压力过大，DiscuzQ 部署到单独的磁盘分区上，或升级 SSD。")]),t._v(" "),a("li",[t._v("数据库压力过大，升级腾讯云数据库。")])])])]),t._v(" "),a("h3",{attrs:{id:"选用-ssd-磁盘-提升数据访问性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选用-ssd-磁盘-提升数据访问性能"}},[t._v("#")]),t._v(" 选用 SSD 磁盘，提升数据访问性能")]),t._v(" "),a("p",[t._v("升级为 SSD 磁盘，可以改善数据访问性能，尤其是本地缓存的访问性能，推荐个人站长将 Discuz! Q 站点所在的硬盘设置为 SSD 云硬盘，能较大提升系统性能。如下图所示：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://main.qcloudimg.com/raw/be56646d4dd96f87737c951f1866d32a.png",alt:""}})]),t._v(" "),a("p",[t._v("不同类型云硬盘的性能指标可参考："),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/362/2353#.E6.80.A7.E8.83.BD.E6.8C.87.E6.A0.87",target:"_blank",rel:"noopener noreferrer"}},[t._v("性能指标"),a("OutboundLink")],1),t._v("。调整云硬盘性能详情操作参见："),a("a",{attrs:{href:"https://cloud.tencent.com/document/product/362/51897",target:"_blank",rel:"noopener noreferrer"}},[t._v("调整云硬盘性能"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"php-性能优化调优"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php-性能优化调优"}},[t._v("#")]),t._v(" PHP 性能优化调优")]),t._v(" "),a("h4",{attrs:{id:"开启-opcache"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启-opcache"}},[t._v("#")]),t._v(" 开启 OPcache")]),t._v(" "),a("p",[t._v("开启 OPcache 可参考："),a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1678575",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用 OPcache 提升 PHP 的性能"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"调优-php-进程数量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调优-php-进程数量"}},[t._v("#")]),t._v(" 调优 PHP 进程数量")]),t._v(" "),a("p",[t._v("php-fpm 进程数可以根据服务器内存大小配置，例如，服务器内存为2G，那么可以配置1G的 PHP 进程，按照每个进程最多占用50M计算，进程数最多设置20。\n进入 PHP 的安装目录，找到 "),a("code",[t._v("php-fpm.conf")]),t._v("文件，设置以下参数（如果没有这些参数可以在文件末尾进行追加）。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("pm=dynamic\npm.start_servers = 10\npm.min_spare_servers = 10\npm.max_spare_servers = 20\npm.max_requests = 100\n")])])]),a("p",[t._v("通常对于 Discuz! Q 的个人站长，机器内存都比较小，建议将 "),a("code",[t._v("pm")]),t._v("  设置成  "),a("code",[t._v("dynamic")]),t._v("，并根据实际情况设置以下配置项。")]),t._v(" "),a("ul",[a("li",[t._v("start_servers： php-fpm服务启动时自动创建的进程数，建议设置最大进程数的一半即可，本示例最多进程数为20，那么 "),a("code",[t._v("start_servers")]),t._v("设置成10。")]),t._v(" "),a("li",[t._v("min_spare_servers： 最小进程数，设置成 "),a("code",[t._v("start_servers")]),t._v(" 相同值即可。")]),t._v(" "),a("li",[t._v("max_spare_servers： 最大进程数，设置成依据内存预估的最大进程数，此处为20。")]),t._v(" "),a("li",[t._v("max_requests： 请求数达到一定数值自动重启进程，避免内存泄漏，该值可依据内存大小适当配置，例如小内存机器，可适当调低该值，大内存机器可适当调高该值。")])]),t._v(" "),a("h4",{attrs:{id:"升级-php-版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#升级-php-版本"}},[t._v("#")]),t._v(" 升级 PHP 版本")]),t._v(" "),a("p",[t._v("Discuz! Q 支持的 PHP 最低版本为 "),a("code",[t._v("7.2.3")]),t._v("，对于 php8.x 的支持度暂未测试，您可以将 PHP 版本升级到 php7.x 的最小版本 "),a("code",[t._v("7.4.21")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"nginx-配置来提升性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置来提升性能"}},[t._v("#")]),t._v(" Nginx 配置来提升性能")]),t._v(" "),a("ul",[a("li",[t._v("gzip 压缩："),a("code",[t._v("nginx server")]),t._v(" 块中开启 gzip 压缩。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('gzip on;\n gzip_min_length 1024;\n gzip_types application/json text/css text/javascript application/x-javascript application/vnd.api+json;\n gzip_disable "MSIE [1-6]\\.";\n gzip_comp_level 6;\n gzip_static on;\n')])])]),a("ul",[a("li",[t._v("开启 http2： 使用 http2 会比 http/1.1 更加地高效。具体可参考："),a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1532739",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTPS 配置"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("listen 443 ssl http2;\n")])])]),a("ul",[a("li",[t._v("开启缓存:详情操作可参考："),a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1432582",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx下关于缓存控制字段cache-control的配置说明"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("location ~ .*\\.(js|css|jpg|png|svg|webp)$ {\n    expires 1d;\n}\n")])])])])}),[],!1,null,null,null);a.default=_.exports}}]);