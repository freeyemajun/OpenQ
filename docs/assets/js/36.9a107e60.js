(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{224:function(a,t,s){"use strict";s.r(t);var e=s(6),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"常规部署方式升级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常规部署方式升级"}},[a._v("#")]),a._v(" 常规部署方式升级")]),a._v(" "),t("h2",[a._v(" 概述")]),a._v(" "),t("p",[a._v("本文档将指导您如何升级使用常规部署方式的 Discuz! Q 。")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("常规部署方式升级，适用于：基于手动配置的环境、基于宝塔、基于镜像部署方式。")])]),a._v(" "),t("h2",[a._v("  前提条件")]),a._v(" "),t("p",[a._v("已使用基于手动配置的环境、基于宝塔、基于镜像部署方式部署 Discuz! Q。")]),a._v(" "),t("h2",[a._v(" 操作指南")]),a._v(" "),t("p",[a._v("常规部署方式支持以下两种升级方式，您可以根据您的具体需求进行选择。")]),a._v(" "),t("h2",{attrs:{id:"使用-dl-php-自动升级方式-推荐"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-dl-php-自动升级方式-推荐"}},[a._v("#")]),a._v(" 使用 dl.php 自动升级方式（推荐）")]),a._v(" "),t("ol",[t("li",[a._v("使用浏览器访问 "),t("code",[a._v("http(s)://<已安装部署成功的网址>/dl.php")]),a._v(" ,如官网 "),t("code",[a._v("https://discuz.chat")]),a._v(" 则为 "),t("code",[a._v("https://discuz.chat/dl.php")]),a._v(" 。如下图所示：\n"),t("img",{attrs:{src:"https://main.qcloudimg.com/raw/2d3ecf300f7807d3ae265c300f706293.png",alt:""}})])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("如果左上角 Logo 处没有版本号信息，请下载并替换最新版本的 "),t("a",{attrs:{href:"https://discuzq-docs-1258344699.cos.ap-guangzhou.myqcloud.com/dl.php",target:"_blank",rel:"noopener noreferrer"}},[a._v("安装工具"),t("OutboundLink")],1),a._v("，将下载的 "),t("code",[a._v("dl.php")]),a._v(" 文件放置于 "),t("code",[a._v("public")]),a._v(" 目录下。")])]),a._v(" "),t("li",[t("p",[a._v("为了安全，"),t("code",[a._v("dl.php")]),a._v(" 每次运行完成后，会在其所在目录下生成 "),t("code",[a._v("dl.php.lock")]),a._v(" 锁文件，升级前请先删除此文件。"),t("code",[a._v("dl.php.lock")]),a._v("位于"),t("code",[a._v("public")]),a._v("目录下。")])])])]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[a._v("单击【下一步】，Discuz! Q 将会对升级进行检查，检查成功后，在计划安装版本页面，选择需要升级的版本。如下图所示：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://main.qcloudimg.com/raw/f1936d438b708483659ab95caa1744a4.png",alt:""}})]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("ul",[t("li",[a._v("选择下载的版本号必须大于当前安装版本号 ，否则无法继续。")]),a._v(" "),t("li",[a._v("默认勾选【升级前删除原来的静态文件目录】，可根据实际需求进行选择。")])])]),a._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[a._v("单击【下一步】, Discuz! Q 将会自动执行升级。升级成功将会提示以下信息。如下图所示：")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://main.qcloudimg.com/raw/d01c06ff8ed24625cd882866c7da5295.png",alt:""}})]),a._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[a._v("单击下一步完成升级。")])]),a._v(" "),t("h2",{attrs:{id:"手动升级方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#手动升级方式"}},[a._v("#")]),a._v(" 手动升级方式")]),a._v(" "),t("p",[a._v("手动升级版本方式请根据您的现有版本与所需升级到的版本进行选择：")]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("ul",[t("li",[a._v("以下操作以使用 Nginx 服务为例。如您使用其他 Web 服务，建议您使用自动升级方式，或参考以下操作进行升级。")]),a._v(" "),t("li",[a._v("以下升级命令需按从上至下依次执行，否则将可能导致升级失败。")])])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210926"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210926"}},[a._v("#")]),a._v(" 升级到v3.0.210926")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco init:activity\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210917"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210917"}},[a._v("#")]),a._v(" 升级到v3.0.210917")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:issue_at\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210902"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210902"}},[a._v("#")]),a._v(" 升级到v3.0.210902")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:removeNicknameBlank\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210819"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210819"}},[a._v("#")]),a._v(" 升级到v3.0.210819")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:addVotePermission\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210729"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210729"}},[a._v("#")]),a._v(" 升级到v3.0.210729")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:nicknameDuplicateRemoval\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210715"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210715"}},[a._v("#")]),a._v(" 升级到v3.0.210715")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco notifications:migration\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210713"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210713"}},[a._v("#")]),a._v(" 升级到v3.0.210713")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:stopWordsNicknameSet\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210706"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210706"}},[a._v("#")]),a._v(" 升级到v3.0.210706")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco postForeignKey:update\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210628"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210628"}},[a._v("#")]),a._v(" 升级到v3.0.210628")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:addUnpaidPermission\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v3-0-210609"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v3-0-210609"}},[a._v("#")]),a._v(" 升级到v3.0.210609")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 discuz 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:upgradeOldPermissionData\nphp disco upgrade:nicknameSet\nphp disco upgrade:bindType\nphp disco upgrade:questionMigration\nphp disco upgrade:noticeAdd\nphp disco thread:migration\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("修改您的网站主目录配置文件 "),t("code",[a._v("config.php")]),a._v(", 查找字段 "),t("code",[a._v("'disks' =>")]),a._v("的配置项添加如下内容：")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(" 'background' =>[\n                    'driver'    =>  'local',\n                    'root'    =>  storage_path('app/public/background'),\n                    'url'    =>  'background',\n                    'visibility'    =>  'public',\n                ],\n'background_cos' => [\n                    'driver' => 'cos',\n                    'root' => storage_path('app/public/background'),\n                    'url' => 'background',\n                    'visibility' => 'public',\n                ]\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-3-210528"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-3-210528"}},[a._v("#")]),a._v(" 升级到v2.3.210528")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:noticeAdd\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-3-210412"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-3-210412"}},[a._v("#")]),a._v(" 升级到v2.3.210412")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:noticeAdd\nphp disco upgrade:noticeIteration\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-3-210207"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-3-210207"}},[a._v("#")]),a._v(" 升级到v2.3.210207")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令即可完成升级。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:notice\nphp disco upgrade:notice-iteration\nphp disco upgrade:groupPermissionAdd\nphp disco upgrade:settingAdd\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("升级成功前如您已设置为红色主题，升级成功后将默认回退为蓝色主题，您需在 Discuz! Q 管理后台重新设置为红色主题。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-3-210202"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-3-210202"}},[a._v("#")]),a._v(" 升级到v2.3.210202")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:notice\nphp disco upgrade:notice-iteration\nphp disco upgrade:groupPermissionAdd\nphp disco upgrade:settingAdd\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-1-201113"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-1-201113"}},[a._v("#")]),a._v(" 升级到v2.1.201113")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:split-permissions\nphp disco site:switch\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("修改您的 Nginx 配置文件 "),t("code",[a._v("nginx.conf")]),a._v(" 的 "),t("code",[a._v("index")]),a._v(" 配置项，修改为以下参数。")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("index index.php index.html;\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-1-201029"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-1-201029"}},[a._v("#")]),a._v(" 升级到v2.1.201029")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 discuz 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:notice\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("修改网站主目录下的 "),t("code",[a._v("config.php")]),a._v(" 配置文件, 查找字段 "),t("code",[a._v("'providers' =>")]),a._v("的配置修改为以下内容：")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v(" 'providers' => [\n        App\\Formatter\\FormatterServiceProvider::class,\n        App\\Passport\\Oauth2ServiceProvider::class,\n        App\\Providers\\AppServiceProvider::class,\n        App\\Providers\\AttachmentServiceProvider::class,\n        App\\Providers\\CategoryServiceProvider::class,\n        App\\Providers\\EventServiceProvider::class,\n        App\\Providers\\OrderServiceProvider::class,\n        App\\Providers\\PostServiceProvider::class,\n        App\\Providers\\SettingsServiceProvider::class,\n        App\\Providers\\ThreadServiceProvider::class,\n        App\\Providers\\UserServiceProvider::class,\n        App\\Providers\\DialogMessageServiceProvider::class,\n        App\\Providers\\QuestionServiceProvider::class,\n    ],\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v2-0-201001、v1-0-200911、v1-0-200821、v1-0-200806、v1-0-200723、v1-0-200715、v1-0-200707、v1-0-200705、v0-5-200522、v0-5-200424"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v2-0-201001、v1-0-200911、v1-0-200821、v1-0-200806、v1-0-200723、v1-0-200715、v1-0-200707、v1-0-200705、v0-5-200522、v0-5-200424"}},[a._v("#")]),a._v(" 升级到v2.0.201001、v1.0.200911、v1.0.200821、v1.0.200806、v1.0.200723、v1.0.200715、v1.0.200707、v1.0.200705、v0.5.200522、v0.5.200424")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 discuz 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v1-0-200710"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v1-0-200710"}},[a._v("#")]),a._v(" 升级到v1.0.200710")]),a._v(" "),t("p",[a._v("1.需配置PHP，启用 "),t("code",[a._v("exif")]),a._v(" 扩展。")]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v1-0-200703"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v1-0-200703"}},[a._v("#")]),a._v(" 升级到v1.0.200703")]),a._v(" "),t("ol",[t("li",[a._v("修改 Web 服务配置，修改内容请查看："),t("a",{attrs:{href:"https://discuz.com/docs/Linux%20%E4%B8%BB%E6%9C%BA.html#nginx",target:"_blank",rel:"noopener noreferrer"}},[a._v("Ngnix服务"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\nphp disco upgrade:category-permission \nphp disco upgrade:videoSize\nphp disco upgrade:notice\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("修改网站主目录下的 "),t("code",[a._v("config.php")]),a._v(" 配置文件，将字段 "),t("code",[a._v("'providers' =>")]),a._v(" 的配置项修改为以下内容：")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'providers' => [\n    App\\Formatter\\FormatterServiceProvider::class,\n    App\\Passport\\Oauth2ServiceProvider::class,\n    App\\Providers\\AppServiceProvider::class,\n    App\\Providers\\AttachmentServiceProvider::class,\n    App\\Providers\\CategoryServiceProvider::class,\n    App\\Providers\\EventServiceProvider::class,\n    App\\Providers\\OrderServiceProvider::class,\n    App\\Providers\\PostServiceProvider::class,\n    App\\Providers\\SettingsServiceProvider::class,\n    App\\Providers\\ThreadServiceProvider::class,\n    App\\Providers\\UserServiceProvider::class,\n    App\\Providers\\DialogMessageServiceProvider::class,\n],\n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v0-5-200508"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v0-5-200508"}},[a._v("#")]),a._v(" 升级到v0.5.200508")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),t("p",[a._v("如果运行以上脚本时出现错误，请下载"),t("a",{attrs:{href:"https://discuzq-docs-1258344699.cos.ap-guangzhou.myqcloud.com/2020_04_14_104730_update_users_table.php",target:"_blank",rel:"noopener noreferrer"}},[a._v("此文件"),t("OutboundLink")],1),a._v("，替换 "),t("code",[a._v("discuz")]),a._v(" 主目录下的 "),t("code",[a._v("database/migrations")]),a._v(" 目录下的同名文件，然后再次执行 "),t("code",[a._v("php disco migrate --force")]),a._v(".")])]),a._v(" "),t("h4",{attrs:{id:"升级到v0-5-200410"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v0-5-200410"}},[a._v("#")]),a._v(" 升级到v0.5.200410")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("附件图片统一接入对象存储服务后，需要重新配置”后台-全局-腾讯云设置-对象存储“中的“访问域名”。访问域名获取方式为：“腾讯云-对象存储-存储桶列表-配置管理-基本配置”中的“访问域名”（详见"),t("a",{attrs:{href:"https://dl.discuz.chat/dzq_userguide_latest.pdf",target:"_blank",rel:"noopener noreferrer"}},[a._v("使用手册"),t("OutboundLink")],1),a._v("“2.2.7.6对象存储”部分说明）。")])]),a._v(" "),t("li",[t("p",[a._v("修改网站主目录下的 "),t("code",[a._v("config.php")]),a._v(" 配置文件，将字段 "),t("code",[a._v("attachment")]),a._v(" 修改为以下配置：")])])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'attachment' => [\n")])])]),t("p",[a._v("修改为：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'attachment_cos' => [\n")])])]),t("p",[a._v("并在此配置之前加入以下配置：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'attachment' => [\n    'driver' => 'local',\n    'root'   => storage_path('app'),\n    'url'    => 'attachment'\n],\n")])])]),t("p",[a._v("最终配置如下所示：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'attachment' => [\n    'driver' => 'local',\n    'root'   => storage_path('app'),\n    'url'    => 'attachment'\n],\n'attachment_cos' => [\n    'driver' => 'cos',\n    'root'   => storage_path('app/public/attachment'),\n    'url'    => 'attachment'\n],\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])]),a._v(" "),t("h4",{attrs:{id:"升级到v0-4-200331"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级到v0-4-200331"}},[a._v("#")]),a._v(" 升级到v0.4.200331")]),a._v(" "),t("p",[a._v("按 v0.4.200331 升级的要求完成数据库升级和配置文件修改即可完成升级。")]),a._v(" "),t("h4",{attrs:{id:"从任意版本升级到-v0-4-200331"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从任意版本升级到-v0-4-200331"}},[a._v("#")]),a._v(" 从任意版本升级到 v0.4.200331")]),a._v(" "),t("ol",[t("li",[a._v("在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令:")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("修改网站主目录下的 "),t("code",[a._v("config.php")]),a._v(" 配置文件，在"),t("code",[a._v("attachment")]),a._v("字段之前，加入以下配置：")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("'avatar_cos' => [\n  'driver' => 'cos',\n  'root' => storage_path('app/public/avatars'),\n  'url' => 'avatar',\n  'visibility' => 'public',\n],\n\n")])])]),t("h4",{attrs:{id:"从任意版本升级到-v0-4-200327"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从任意版本升级到-v0-4-200327"}},[a._v("#")]),a._v(" 从任意版本升级到 v0.4.200327")]),a._v(" "),t("ol",[t("li",[a._v("需要在完成以上步骤后，在终端中，进入您的 "),t("code",[a._v("discuz")]),a._v(" 的主目录并运行以下命令:、")])]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("php disco migrate --force\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("重启 Nignx 服务即可完成升级。")])])])}),[],!1,null,null,null);t.default=r.exports}}]);