(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{218:function(t,e,s){"use strict";s.r(e);var a=s(6),c=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"常见问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[t._v("#")]),t._v(" 常见问题")]),t._v(" "),e("h3",{attrs:{id:"本页目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本页目录"}},[t._v("#")]),t._v(" 本页目录")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AEcdn%E8%A7%84%E5%88%99",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何配置CDN规则？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%B0%8F%E5%86%85%E5%AD%98%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E5%AE%9D%E5%A1%94%E9%BB%98%E8%AE%A4%E5%AE%89%E8%A3%85%E7%9A%84-mysql-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("小内存服务器上宝塔默认安装的 MySQL 如何配置？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#windows%E4%B8%8B%E6%8F%90%E7%A4%BA-ssl-%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0%E4%B8%8D%E5%8F%AF%E7%94%A8%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3",target:"_blank",rel:"noopener noreferrer"}},[t._v("Windows下提示 SSL 相关函数不可用如何解决？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#windows%E4%B8%8B%E6%8F%90%E7%A4%BA-ca-%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%BA%93%E9%94%99%E8%AF%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3",target:"_blank",rel:"noopener noreferrer"}},[t._v(" Windows下提示 CA 根证书库错误如何解决？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#web-%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%85%B6%E5%AE%83%E6%8E%A8%E8%8D%90%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web 服务器其它推荐配置？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%A6%82%E4%BD%95%E5%9F%BA%E4%BA%8E-laravel-valet-%E8%BF%90%E8%A1%8C-discuz-q",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何基于 Laravel Valet 运行 Discuz! Q ？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E5%9F%9F%E5%90%8D",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何更改域名？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%8E%9F%E6%9D%A5-http-%E7%9A%84%E7%AB%99-%E6%94%B9%E6%88%90-https-%E4%B9%8B%E5%90%8E-%E8%BF%98%E6%9C%89%E9%83%A8%E5%88%86%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E5%8E%9F%E6%9D%A5%E7%9A%84-http-%E9%93%BE%E6%8E%A5",target:"_blank",rel:"noopener noreferrer"}},[t._v("原来 http 的站，改成 https 之后，还有部分资源使用原来的 http 链接？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#discuz-q-%E5%A6%82%E4%BD%95%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD",target:"_blank",rel:"noopener noreferrer"}},[t._v("Discuz! Q 如何数据备份？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%AE%B9%E5%99%A8%E7%9A%84%E6%9B%B4%E5%A4%9A%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E",target:"_blank",rel:"noopener noreferrer"}},[t._v("容器的更多配置说明？"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%AE%89%E8%A3%85%E5%90%8E-%E9%A6%96%E5%B1%8F%E6%97%A0%E9%99%90%E5%8A%A0%E8%BD%BD%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装后，首屏无限加载如何解决?"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#%E5%AE%89%E8%A3%85%E5%90%8E%E5%9B%BE%E7%89%87%E4%B8%8D%E8%83%BD%E6%98%BE%E7%A4%BA-%E6%B2%A1%E4%BD%BF%E7%94%A8%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8-%E6%80%8E%E4%B9%88%E5%8A%9E",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装后图片不能显示(没使用对象存储)怎么办?"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://discuzq.icu/docs/%E5%85%B3%E4%BA%8E/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98.html#discuz-q-%E5%8D%87%E7%BA%A7-v2-3-210202-%E7%89%88%E6%9C%AC%E5%90%8E-%E8%BF%9B%E8%A1%8C%E7%BA%A2%E8%93%9D%E4%B8%BB%E9%A2%98%E5%88%87%E6%8D%A2%E6%97%B6%E6%8A%A5%E9%94%99-warning-shell-exec-has-been-disabled-for-security-reasons-in-%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3",target:"_blank",rel:"noopener noreferrer"}},[t._v("Discuz! Q 升级 v2.3.210202 版本后，进行红蓝主题切换时报错 "),e("code",[t._v("Warning: shell_exec() has been disabled for security reasons in")]),t._v(" 如何解决?"),e("OutboundLink")],1)])]),t._v(" "),e("h4",{attrs:{id:"如何配置cdn规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何配置cdn规则"}},[t._v("#")]),t._v(" 如何配置CDN规则？")]),t._v(" "),e("p",[t._v("在腾讯云 CDN 添加域名的时候，请在【缓存配置】> 【节点缓存过期配置】处增加以下两条规则：")]),t._v(" "),e("ul",[e("li",[t._v("规则类型为【文件目录】，内容设置为"),e("code",[t._v("/apiv3")]),t._v("，缓存选项选择【不缓存】。")]),t._v(" "),e("li",[t._v("规则类型为【文件目录】，内容设置为"),e("code",[t._v("/api")]),t._v("，缓存选项选择【不缓存】。优先级调整为“最顶部”如下图所示：")])]),t._v(" "),e("p",[e("img",{attrs:{src:"https://main.qcloudimg.com/raw/1bf841c2eefa53b525ae7955743920d1.png",alt:""}})]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("若您使用 Discuz! Q 2.0 版本，无需设置 "),e("code",[t._v("/apiv3")]),t._v(" 规则。")])]),t._v(" "),e("h4",{attrs:{id:"小内存服务器上宝塔默认安装的-mysql-如何配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小内存服务器上宝塔默认安装的-mysql-如何配置"}},[t._v("#")]),t._v(" 小内存服务器上宝塔默认安装的 MySQL 如何配置？")]),t._v(" "),e("p",[t._v("在小内存的服务器上(1G~2G)，宝塔上的默认 MySQL 配置占用了过多内存，可进行如下一些配置以优化 MySQL 内存占用：")]),t._v(" "),e("ul",[e("li",[t._v("在 MySQL 设置的 【性能调整】中，将优化方案选择为【1-2GB】。")]),t._v(" "),e("li",[t._v("在 1GB 的服务器上，可以将【性能调整】页中的参数进一步调整：\n"),e("ul",[e("li",[e("code",[t._v("innodb_buffer_pool_size")]),t._v(" 可调整为 128 或 64。")]),t._v(" "),e("li",[e("code",[t._v("innodb_log_buffer_size")]),t._v(" 可调整为 8。")]),t._v(" "),e("li",[e("code",[t._v("thread_cache_size")]),t._v(" 可调整为 32。")]),t._v(" "),e("li",[e("code",[t._v("max_connections")]),t._v(" 可调整为 32。")])])]),t._v(" "),e("li",[t._v("在 MySQL 设置的【配置修改】中，在"),e("code",[t._v("[mysqld]")]),t._v("处，下方加入一行"),e("code",[t._v("performance_schema = off")]),t._v("语句。")])]),t._v(" "),e("h4",{attrs:{id:"windows下提示-ssl-相关函数不可用如何解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#windows下提示-ssl-相关函数不可用如何解决"}},[t._v("#")]),t._v(" Windows下提示 SSL 相关函数不可用如何解决？")]),t._v(" "),e("p",[t._v("在 Windows 下，PHP的 SSL 相关函数有可能不可用，请按以下任一方法配置。(参考"),e("a",{attrs:{href:"https://www.php.net/manual/en/openssl.installation.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("PHP的openssl安装文档"),e("OutboundLink")],1),t._v(")")]),t._v(" "),e("p",[t._v("首先，在您的 PHP 安装目录下，查找 "),e("code",[t._v("openssl.cnf")]),t._v(" 文件。")]),t._v(" "),e("p",[e("strong",[t._v("方法一:")]),t._v("\n新建一个 "),e("strong",[t._v("系统")]),t._v(" 环境变量，变量名为 "),e("code",[t._v("OPENSSL_CONF")]),t._v("，变量值为上面找到的 "),e("code",[t._v("openssl.cnf")]),t._v(" 文件的完整路径。之后退出您的控制面板程序(例如 phpstudy )再重新打开，然后重启 PHP  服务。")]),t._v(" "),e("p",[e("strong",[t._v("方法二：")])]),t._v(" "),e("ul",[e("li",[t._v("PHP 版本小于 7.4，建立目录 "),e("code",[t._v("c:\\usr\\local\\ssl\\")]),t._v(" ，然后将 PHP 安装目录下找到的 "),e("code",[t._v("openssl.cnf")]),t._v(" 文件复制过去。")]),t._v(" "),e("li",[t._v("PHP 版本为 7.4 及以上, 64位版本，建立目录 "),e("code",[t._v("C:\\Program Files\\Common Files\\SSL\\")]),t._v("，将 "),e("code",[t._v("openssl.cnf")]),t._v(" 文件复制过去。")]),t._v(" "),e("li",[t._v("PHP版本为 7.4 及以上, 32位版本，建立目录 "),e("code",[t._v("C:\\Program Files (x86)\\Common Files\\SSL\\")]),t._v("，将 "),e("code",[t._v("openssl.cnf")]),t._v(" 文件复制过去。")])]),t._v(" "),e("h4",{attrs:{id:"windows下提示-ca-根证书库错误如何解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#windows下提示-ca-根证书库错误如何解决"}},[t._v("#")]),t._v(" Windows下提示 CA 根证书库错误如何解决？")]),t._v(" "),e("p",[t._v("CA根证书错误会导致 PHP 无法验证SSL证书，从而无法正确调用腾讯云API、微信API 等。解决方案如下：")]),t._v(" "),e("ul",[e("li",[t._v("下载 "),e("a",{attrs:{href:"https://dl.discuz.chat/mirrors/cacert.pem",target:"_blank",rel:"noopener noreferrer"}},[t._v("根证书文件"),e("OutboundLink")],1),t._v("，保存为 "),e("code",[t._v("C:\\cacert.pem")])]),t._v(" "),e("li",[t._v("修改"),e("code",[t._v("php.ini")]),t._v("，修改其中的以下两行内容，并去掉前面的"),e("code",[t._v(";")]),t._v("符号。如下所示：")])]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("curl.cainfo=c:\\cacert.pem\nopenssl.cafile=c:\\cacert.pem\n")])])]),e("h4",{attrs:{id:"web-服务器其它推荐配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-服务器其它推荐配置"}},[t._v("#")]),t._v(" Web 服务器其它推荐配置？")]),t._v(" "),e("p",[t._v("除了安装文档中的配置，您可以参考以下配置进一步优化系统运行：")]),t._v(" "),e("p",[e("strong",[t._v("启动 gzip 压缩")])]),t._v(" "),e("p",[t._v("Discuz! Q 在运行中，浏览器会请求的文本类文档包含以下类型："),e("code",[t._v("text/html")]),t._v(", "),e("code",[t._v("text/css")]),t._v(", "),e("code",[t._v("application/vnd.api+json")]),t._v(", "),e("code",[t._v("application/x-javascript")]),t._v("，建议在 Web 服务器中打开这些文档类型的 gzip 压缩，以减少下载的数据量。经测算，在 Nginx 中打开 gzip 压缩，并将压缩等级设置为 2 的时候，下载的平均数据量是打开压缩前的 1/3 左右。Nginx 中的配置参考如下：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('  gzip on;\n  gzip_min_length 1024;\n  gzip_types text/css application/x-javascript application/javascript application/vnd.api+json;\n  gzip_disable "MSIE [1-6]\\.";\n  gzip_comp_level 2;\n')])])]),e("p",[e("strong",[t._v("获取客户的真实IP")])]),t._v(" "),e("p",[t._v("在 Discuz! Q 中，因安全原因，只使用 "),e("code",[t._v("$_SERVER['REMOTE_ADDR']")]),t._v(" 这一种方式获取客户的 IP 地址。请正确配置您的服务器，以保证 Discuz! Q 可以正确获取到客户的 IP 地址。")]),t._v(" "),e("ul",[e("li",[t._v("如果您是通过您的服务器上的公网 IP 地址直接对外提供服务，则无需额外配置。")]),t._v(" "),e("li",[t._v("如果您使用腾讯云的负载均衡器(CLB) 与腾讯云的云服务器(CVM)的配置，无论配置的是 4 层还是 7 层负载均衡，都无需额外配置。")]),t._v(" "),e("li",[t._v("如果您使用自建的负载均衡，或其它的负载均衡，则默认只能获取到负载均衡的IP，无法获取到用户的真实IP，请按"),e("a",{attrs:{href:"https://cloud.tencent.com/document/product/214/3728",target:"_blank",rel:"noopener noreferrer"}},[t._v("此文档"),e("OutboundLink")],1),t._v("配置，获取用户的真实IP。")])]),t._v(" "),e("p",[e("strong",[t._v("启用 opcache")])]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("php.ini")]),t._v("中启用 opcache，可提高 PHP 代码的运行效率，参考配置如下")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("[opcache]\nopcache.enable = 1\nopcache.memory_consumption = 256\nopcache.interned_strings_buffer = 8\nopcache.max_accelerated_files = 10000\nopcache.revalidate_freq = 240\nopcache.fast_shutdown = 1\nopcache.enable_cli = 0\nopcache.file_cache = /tmp\nopcache.error_log = log/opcache_error.log\n")])])]),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),e("p",[t._v("设置成功后，每次更新Discuz! Q，需要**重启 php-fpm **，新的代码才能生效。")])]),t._v(" "),e("h4",{attrs:{id:"如何基于-laravel-valet-运行-discuz-q"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何基于-laravel-valet-运行-discuz-q"}},[t._v("#")]),t._v(" 如何基于 Laravel Valet 运行 Discuz! Q ？")]),t._v(" "),e("p",[t._v("假设本地的"),e("code",[t._v("park")]),t._v("目录是 "),e("code",[t._v("~/sites")]),t._v("，通过 composer 或离线安装将 "),e("code",[t._v("Discuz! Q")]),t._v("安装到 "),e("code",[t._v("~/sites/discuz")]),t._v(" 目录之后，将"),e("a",{attrs:{href:"https://dl.discuz.chat/valet/LocalValetDriver.php",target:"_blank",rel:"noopener noreferrer"}},[t._v("此文件"),e("OutboundLink")],1),t._v(" 下载并保存到 "),e("code",[t._v("/sites/discuz")]),t._v(" 目录下，之后就可以直接访问： "),e("code",[t._v("http://discuz.test")]),t._v("。")]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("数据库需要另外安装。")])]),t._v(" "),e("h4",{attrs:{id:"如何更改域名"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何更改域名"}},[t._v("#")]),t._v(" 如何更改域名？")]),t._v(" "),e("p",[t._v("您只需要删除 "),e("code",[t._v("storage/cache/data")]),t._v(" 目录中的内容与 "),e("code",[t._v("storage/formatter")]),t._v(" 目录中的内容即可。")]),t._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[t._v("DANGER")]),t._v(" "),e("p",[t._v("请不要将目录删除，只删除其中的内容。")])]),t._v(" "),e("h4",{attrs:{id:"原来-http-的站-改成-https-之后-还有部分资源使用原来的-http-链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#原来-http-的站-改成-https-之后-还有部分资源使用原来的-http-链接"}},[t._v("#")]),t._v(" 原来 http 的站，改成 https 之后，还有部分资源使用原来的 http 链接？")]),t._v(" "),e("p",[t._v("您只需要删除 "),e("code",[t._v("storage/cache/data")]),t._v(" 目录中的内容与 "),e("code",[t._v("storage/formatter")]),t._v(" 目录中的内容即可。")]),t._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[t._v("DANGER")]),t._v(" "),e("p",[t._v("请不要将目录删除，只删除其中的内容。")])]),t._v(" "),e("h4",{attrs:{id:"discuz-q-如何数据备份"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#discuz-q-如何数据备份"}},[t._v("#")]),t._v(" Discuz! Q 如何数据备份？")]),t._v(" "),e("p",[t._v("如需备份 Discuz! Q，请备份以下内容：")]),t._v(" "),e("ol",[e("li",[t._v("数据库。")]),t._v(" "),e("li",[t._v("config 目录。")]),t._v(" "),e("li",[t._v("storage 目录。")])]),t._v(" "),e("h4",{attrs:{id:"容器的更多配置说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#容器的更多配置说明"}},[t._v("#")]),t._v(" 容器的更多配置说明？")]),t._v(" "),e("p",[e("strong",[t._v("如何将数据保存到容器外部")]),t._v("\n本容器支持以下三个外部映射目录：")]),t._v(" "),e("ul",[e("li",[t._v("数据库文件，映射到 "),e("code",[t._v("/var/lib/mysqldb/")]),t._v("。")]),t._v(" "),e("li",[t._v("Discuz! Q的配置与存储目录，映射到 "),e("code",[t._v("/var/lib/discuz/")]),t._v("。")]),t._v(" "),e("li",[t._v("SSL证书文件，映射到 "),e("code",[t._v("/etc/nginx/certs/")]),t._v("，其中"),e("strong",[t._v("要求")]),t._v("存在两个文件 "),e("code",[t._v("discuz.crt")]),t._v(" 和 "),e("code",[t._v("discuz.key")]),t._v("。如果不使用SSL协议，请不要配置此目录，并且不映射 443 端口。")])]),t._v(" "),e("p",[t._v("因此，如果如果您想长期使用容器来运行 Discuz! Q，建议在启动容器的时候加入这三个参数进行映射。")]),t._v(" "),e("p",[t._v("例如数据库文件，在本地(宿主机)上，想保存到 "),e("code",[t._v("/data/mysql-data")]),t._v("，Discuz! Q的运行数据，保存到 "),e("code",[t._v("/data/discuz")]),t._v("，SSL证书文件放在 "),e("code",[t._v("/data/certs/discuz.crt")]),t._v(" 和 "),e("code",[t._v("/data/certs/discuz.key")]),t._v("，同时不想对外开放 80 端口，那启动容器的命令就是：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("docker run -d --restart=always \\\n  -p 443:443 \\\n  -v /data/discuz:/var/lib/discuz \\\n  -v /data/mysql-data:/var/lib/mysqldb \\\n  -v /data/certs:/etc/nginx/certs \\\n  ccr.ccs.tencentyun.com/discuzq/dzq:latest\n")])])]),e("p",[t._v("启动之后，访问 "),e("code",[t._v("https://<域名>/install")]),t._v(" 就可以开始安装，并正常使用。")]),t._v(" "),e("div",{staticClass:"custom-block danger"},[e("p",{staticClass:"custom-block-title"},[t._v("DANGER")]),t._v(" "),e("p",[t._v("请一定要访问外部用户将要访问的协议( "),e("code",[t._v("http://")]),t._v(" 或 "),e("code",[t._v("https://")]),t._v(" ) 加 "),e("strong",[t._v("域名")]),t._v(" 加 "),e("code",[t._v("/install")]),t._v(" 进行安装，否则会导致自动获取的站点 URL 配置不正确，站点工作不正常。")])]),t._v(" "),e("p",[e("strong",[t._v("基于容器的升级")])]),t._v(" "),e("p",[t._v("只要将数据保存到了容器外部，容器就可以升级。在升级前，要将原容器先停止并删除(执行此命令时，一定要确保自己已经将数据保存到了容器外部)。")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("docker stop <容器 ID>\ndocker rm <容器 ID>\n")])])]),e("p",[t._v("其中的"),e("code",[t._v("<容器 ID>")]),t._v("，可以通过 "),e("code",[t._v("docker ps")]),t._v(" 命令看到。\n然后用以下命令下载最新版本镜像：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("docker pull ccr.ccs.tencentyun.com/discuzq/dzq:latest\n")])])]),e("p",[t._v("再使用上次启动相同的命令重新启动即可。")]),t._v(" "),e("p",[t._v("如果需要执行升级文档中要求的其它升级命令，请先登录容器")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("docker exec -it <容器 ID> /bin/bash\n")])])]),e("p",[t._v("然后就可以执行升级文档中要求的相关的命令，例如：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v(" cd /var/www/discuz\n php disco migrate --force\n")])])]),e("p",[e("strong",[t._v("基于容器的一些其它配置")])]),t._v(" "),e("ul",[e("li",[t._v("如果您想对 mysql 进行管理，可选择以下两种方法之一：\n"),e("ul",[e("li",[t._v("登录进容器，用 mysql 命令进行管理 "),e("code",[t._v("docker exec -it <容器id> /bin/bash")]),t._v("。")]),t._v(" "),e("li",[t._v("将 3306 端口暴露到外面，通过外部工具连上去进行管理。在启动时，加一个 "),e("code",[t._v("-p 3306:3306")]),t._v("。")])])]),t._v(" "),e("li",[t._v("如果您想通过外部的负载均衡进行 SSL 卸载，可开放容器的 80 端口，不开放 443 端口即可。")]),t._v(" "),e("li",[t._v("Nginx 的配置文件，位于容器的 "),e("code",[t._v("/etc/nginx/nginx.conf")]),t._v(" 下，如果需要修改，可通过 "),e("code",[t._v("-v")]),t._v(" 映射自己的配置文件，覆盖这个文件。\n"),e("ul",[e("li",[t._v("例如您本地的配置文件为 "),e("code",[t._v("/data/nginx.conf")]),t._v(" ，可以在上面的启动命令中，加入映射： "),e("code",[t._v("-v /data/nginx.conf:/etc/nginx/nginx.conf")]),t._v("，即可覆盖系统原来内置的 Nginx 配置文件。")])])]),t._v(" "),e("li",[e("code",[t._v("php-fpm")]),t._v(" 的配置文件，位于容器的 "),e("code",[t._v("/etc/php/7.2/fpm/pool.d/www.conf")]),t._v("，也可同样映射修改。")]),t._v(" "),e("li",[t._v("控制 PHP 上传大小的文件，位于容器的 "),e("code",[t._v("/etc/php/7.2/fpm/conf.d/30-upload-size.ini")]),t._v(", 当前设置为20M，可同样映射修改。")])]),t._v(" "),e("h4",{attrs:{id:"安装后-首屏无限加载如何解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装后-首屏无限加载如何解决"}},[t._v("#")]),t._v(" 安装后，首屏无限加载如何解决?")]),t._v(" "),e("p",[t._v("如果遇到这样的情况，请清空您的浏览器缓存再重试。如果您了解浏览器调试工具，也可以只清空 "),e("code",[t._v("LocalStorage")]),t._v("之后再进行重试。")]),t._v(" "),e("h4",{attrs:{id:"安装后图片不能显示-没使用对象存储-怎么办"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装后图片不能显示-没使用对象存储-怎么办"}},[t._v("#")]),t._v(" 安装后图片不能显示(没使用对象存储)怎么办?")]),t._v(" "),e("p",[t._v("请执行命令以下命令：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("ln -s 安装目录/storage/app/public 安装目录/public/storage\n")])])]),e("p",[t._v("例如站点安装目录是："),e("code",[t._v("/www/wwwroot/discuz.chat/discuz")]),t._v(" ，那么这条命令就是")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("ln -s /www/wwwroot/discuz.chat/discuz/storage/app/public /www/wwwroot/discuz.chat/discuz/public/storage\n")])])]),e("h4",{attrs:{id:"discuz-q-升级-v2-3-210202-版本后-进行红蓝主题切换时报错-warning-shell-exec-has-been-disabled-for-security-reasons-in-如何解决"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#discuz-q-升级-v2-3-210202-版本后-进行红蓝主题切换时报错-warning-shell-exec-has-been-disabled-for-security-reasons-in-如何解决"}},[t._v("#")]),t._v(" Discuz! Q 升级 v2.3.210202 版本后，进行红蓝主题切换时报错 "),e("code",[t._v("Warning: shell_exec() has been disabled for security reasons in")]),t._v(" 如何解决?")]),t._v(" "),e("p",[t._v("如果您遇到这样的情况，您可以删除您 Discuz! Q 站点所使用的 PHP 版本中的禁用函数 "),e("code",[t._v("shell_exec")]),t._v(" 进行解决。如果您的 Discuz! Q 站点是基于宝塔面板安装，您可以参考以下步骤：\n以下操作以宝塔面板 7.5.1、 PHP 7.3 版本为例：")]),t._v(" "),e("ol",[e("li",[t._v("登录您 Discuz! Q 站点的宝塔面板。")]),t._v(" "),e("li",[t._v("单击侧边栏【软件商店】，查找到您 Discuz! Q 站点所使用的 PHP 版本并单击【设置】。如下图所示：\n"),e("img",{attrs:{src:"https://main.qcloudimg.com/raw/a0c511911bec5a00e157cbeda55fdfa3.png",alt:""}})]),t._v(" "),e("li",[t._v('在弹出的"php 管理"窗口中，单击【禁用函数】。')]),t._v(" "),e("li",[t._v("在禁用函数列表中，查找到 "),e("code",[t._v("shell_exec")]),t._v(" 函并单击【删除】。如下图所示：\n"),e("img",{attrs:{src:"https://main.qcloudimg.com/raw/a253d88008f1b6051e8c58a7410ff098.png",alt:""}})]),t._v(" "),e("li",[t._v("重启 PHP 即可完成操作。")])]),t._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),e("p",[t._v("若删除禁用函数 "),e("code",[t._v("shell_exec")]),t._v(" 后，依旧无法正常切换使用。您可以将 Discuz! Q 站点目录下 "),e("code",[t._v("public_1")]),t._v(" 目录中的 "),e("code",[t._v("skin.conf")]),t._v("文件复制并替换至 Discuz! Q 站点目录下的 "),e("code",[t._v("public")]),t._v(" 目录，并重新进行尝试。")])])])}),[],!1,null,null,null);e.default=c.exports}}]);